(function($){window.__tmpFunc={};
nj.directUploader={fileFilter:function(){return[["Images (*.jpg, *jpeg, *.gif, *.png)","*.jpg;*.jpeg;*.gif;*.png;"]];
}};
$.widget("ui.njUploader",(function(){var WIDGET_NAME="ui.njUploader";
var CONST={NSTAT:{DIRECT_UPLOAD:"NC:directupload",CROP_LAYER:"NA:uploader_crop_layer",CROP_UPLOAD:"NC:cropupload",CROP_SET:"NC:cropset",MULTI_LAYER:"NA:uploader_multi_layer",MULTI_UPLOAD:"NC:multiupload",MULTI_SET:"NC:multiset"},TEMPLATE:{DIRECT:'<span id="_nj_uploader_direct_swf" class="_nj_uploader_direct_div" style="position: absolute; width: %directWidht%px; margin-left: -35.5px; overflow: hidden; z-index: 10000; opacity: 1;"></span>',DIRECT_INPUT:'<input class="_nj_uploader_direct_input" type="file" name="Filedata"  style="font-size: 14px; width: 100%; height: 100%; position: absolute; top: 0px; right: 0px; cursor: pointer;" />',CROP:function(sServer){return'<div  class="layerTemplate cropper" id="cropLayer" data-na="'+CONST.NSTAT.CROP_LAYER+'"><div class="shadow"><div class="shadowSide"><div class="subLayerTemplate"><h3>画像アップロード</h3><div class="layerContents" id="layerContent"><ul><li>画像アップロード後、画面に表示された <img height="15" width="12" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_pointer.gif"/> 部分をマウスでドラッグして、切り取りたい領域を選択してください。</li><li class="attention">著作権や他人の権利を侵害する画像をアップロードした場合、利用規約および関連法規により処罰を受けることがあります。</li></ul><div class="btnImgSelect"><img class="_jWriteImageUploadBtn1" height="24" width="95" alt="アップロード" src="'+sServer+'/matome_ver4/img/common/btn_upload.png"/></div><div class="cropperColgroup"><div class="preViewArea"><div class="crop_preview"><img id="_nj_uploader_crop_preview" alt="" src="'+sServer+'/myAdmin/img/cropper_blank.gif"/></div><h4>選択領域プレビュー</h4><h5>画像編集ヘルプ</h5><ul><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_position.gif"/> 選択領域表示</li><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_move.gif"/> 選択領域移動</li><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_size.gif"/> 大きさ調節</li></ul></div><div class="bgCropper"><div class="img_cropper"><p>1024KB未満の　JPG、JPEG、GIF、PNGファイルだけアップロードできます。</p><div class="img_scroll"><img alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif" class="background"/></div><img height="" width="" alt="" class="mask" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/><div class="crop_area jsCrop drag"><div class="crop_object"><img alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/></div><button class="drag_point top_left jsCrop resize" type="button">カット調節点 1 北西</button><button class="drag_point top_right jsCrop resize" type="button">カット調節点 2 北東</button><button class="drag_point bottom_left jsCrop resize" type="button">カット調節点 3 南西</button><button class="drag_point bottom_right jsCrop resize" type="button">カット調節点 4 南東</button></div><img class="crop_hidden" alt="hidden" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/></div></div></div><div class="btns"><button class="btnUpload" data-na="'+CONST.NSTAT.CROP_SET+'"><span>登録</span></button></div></div><a class="layerClose" href="#"><img src="'+sServer+'/matome_ver4/img/js/njUploader/btn_close2.gif" width="19" height="19" alt="閉じる" /></a></div></div></div></div>';
},MULTI:function(sServer){return'<div id="userImageLayer" class="layerTemplate itemEditorImage multiUploader" data-na="'+CONST.NSTAT.MULTI_LAYER+'"><div class="shadow"><div class="shadowSide"><div class="subLayerTemplate"><div class="uploadStatus"><span class="statusWrapper"></span><p>画像アップロード中<span class="uploadStatusInfo"><em>4</em>/20</span></p></div><div class="uploadStatus02" style="display:none;"><span class="statusWrapper"></span><p><span class="uploadStatus02Loading"></span>アイテム追加中</p></div><h3>画像を追加する</h3><div class="layerContents"><dl><dt class="multiUpload">画像のアップロード</dt><dd class="multiUpload"><ul class="note"><li>1枚あたり10MB未満の画像のみ対応しています。<a href="http://help.naver.jp/faq?itemNo=429">対応フォーマットはこちら</a></li><li class="attention">著作権や他人の権利を侵害する画像をアップロードした場合、利用規約および関連法規により処罰を受けることがあります。</li></ul><div class="btnUpload"><div style="position: absolute; overflow: hidden;  width: 96px; height: 24px;" id="_jFlashUploader"></div><img src="'+sServer+'/matome_ver4/img/common/btn_upload.png" width="95" height="24" alt="ファイルを選択"></div><ol class="imagesList"></ol><p class="locationSetting"><label><input type="checkbox" />画像に含まれる位置情報を表示する</label></p></dd><dt class="imageTitle">画像タイトル</dt><dd class="imageTitle"><div class="inTxtWrapper"><input type="text" placeholder="タイトルを入力してください"></div></dd><dt class="introduction">紹介コメント</dt><dd class="introduction"><div class="inTxtWrapper"><textarea  cols="20" rows="3" placeholder="紹介コメントを入力してください"></textarea></div></dd></dl><p class="note">画像タイトルと紹介コメントは、追加される全ての画像で共通となります。</p><div class="btns"><button class="btnEnd"  data-na="'+CONST.NSTAT.MULTI_SET+'"><span>完了</span></button></div></div><a href="#" class="layerClose"><img src="'+sServer+'/matome_ver4/img/js/njUploader/btn_close2.gif" alt="閉じる"></a></div></div></div></div>';
}},upload:{FILE_TYPE:[["Images (*.jpg, *jpeg, *.gif, *.png, *.bmp, その他)","*.jpg;*.jpeg;*.gif;*.png;*.bmp;*.pcx;*.ras;*.pbm;*.pgm;*.ppm"]]},MESSAGE:{REQUIRED:"タイトルを入力してください。",SELECT_IMAGE:"「ファイルを選択」ボタンをクリックして、登録する画像を選んでください。",OVER_TITLE:"タイトルは、100文字以内で入力してください。",OVER_COMMENT:"紹介コメントは、300文字以内で入力してください。",OVER_URL:"URLは、500文字以内で入力してください。",UPLOAD_EXT:"%SIZE%未満のJPG、JPEG、GIF、PNGのみに対応しています。",UPLOAD_FAIL:"アップロードに失敗した画像があります。"}};
var _flashSrc=/alpha/.test(location.host)?"http://static.alpha.naver.jp/matome_ver4/swf/naver_multiUploader_1.0.1.swf":"http://static.naver.jp/matome_ver4/swf/naver_multiUploader_1.0.1.swf";
return{options:{mode:"direct",_parentMode:"",fileSizeMax:10485760,url:"/media/upload",cropSize:"95x95",mode:"multi",flashVars:{},flashSize:{w:"100%",h:"100%"},onUploadComplete:undefined,onUploadError:function(e,res){alert(CONST.MESSAGE.UPLOAD_FAIL);
},onFileSelect:undefined,submit:function(){alert("submit");
}},_oUploader:undefined,_uploadFlash:undefined,_uploadBtn:undefined,_template:undefined,_cropImageSize:undefined,_cropLayer:undefined,failFileName:[],_create:function(){var self=this,element=this.element;
this._uploadBtn=$(element);
this._uploadBtn.bind("click.njUploader",function(e){e.preventDefault();
});
switch(this.options.mode){case"direct":this._setDirect();
break;
case"crop":this._setCrop();
break;
case"multi":this._setMulti();
break;
default:break;
}},_destroy:function(){var self=this;
nj.directUploader["call"+self._h+"_success"]=undefined;
nj.directUploader["call"+self._h+"_error"]=undefined;
nj.directUploader["time"+self._h]=undefined;
},_setDirect:function(){var self=this,o=this.options;
var uploadBtn=this._uploadBtn;
this._uploadBtn.before(CONST.TEMPLATE.DIRECT);
var _njUDiv=this._uploadBtn.prev();
var $base=$(".lyContentsWrap");
var nBaseLeft=0;
var nBaseMarginLeft=0;
if(!$base.length){$base=$(".LyContents");
nBaseLeft=12.5;
nBaseMarginLeft=this._uploadBtn.width()/2*-1;
}if(o._parentMode=="crop"){nBaseLeft=$base.hasClass("lyContentsWrap")?0:this._uploadBtn.width()/2;
}else{nBaseLeft+=this._uploadBtn.offset().left-$base.offset().left;
}var _h=new Date().getTime();
this._h=_h;
_njUDiv.attr("id",_njUDiv.attr("id")+_h);
_njUDiv.css({width:this._uploadBtn.width(),marginLeft:nBaseMarginLeft,height:this._uploadBtn.height(),left:nBaseLeft});
nj.directUploader["call"+_h+"_success"]=$.proxy(this._directUploadComplete,self);
nj.directUploader["call"+_h+"_error"]=$.proxy(this.options.onUploadError,self);
nj.directUploader["call"+_h+"_select"]=$.proxy(this._selectFileInfo,this);
nj.directUploader["time"+_h]=_h;
var sServer=(typeof STATIC_SERVER!=="undefined")?STATIC_SERVER:"";
var eUser=(typeof encodeUser!=="undefined")?"&s="+encodeUser:"";
var encodeUrl=encodeURIComponent((o.url==="/media/upload"?"http://"+location.host+"/media/upload?m=json"+eUser:o.url));
var buttonImageURL=$.browser.msie?sServer+"/matome_ver4/img/common/btn_upload.png":"";
var oFlashVars=$.extend({isDirectUpload:false,isSingleUploader:true,fuCall_getFileTypesFunc:"nj.directUploader.fileFilter",fuCall_getSendDataFunc:"",fuCall_errorMessageFunc:"nj.directUploader.call"+_h+"_error",fuCall_selectFileInfoFunc:"nj.directUploader.call"+_h+"_select",fuCall_uploadStartFileInfoFunc:"",fuCall_uploadProgressFileInfoFunc:"",fuCall_uploadCompleteFileInfoFunc:"",fuCall_uploadCompleteReturnDataFunc:"nj.directUploader.call"+_h+"_success",maxUploadFileCount:1,buttonImageURL:buttonImageURL,uploadURL:encodeUrl},o.flashVars);
var _fvars=[];
$.each(oFlashVars,function(key){_fvars.push(key+"="+this);
});
var sos=new SWFObject(_flashSrc,"directUploader"+_h,this._uploadBtn.width(),this._uploadBtn.height(),"9.0.0");
var nstat=(o._parentMode=="crop")?CONST.NSTAT.CROP_UPLOAD:CONST.NSTAT.DIRECT_UPLOAD;
sos.addParam("data-na",nstat);
sos.addParam("FlashVars",_fvars.join("&amp;"));
sos.addParam("menu","false");
sos.addParam("loop","false");
sos.addParam("quality","high");
if(!$.browser.msie){sos.addParam("wmode","transparent");
}sos.addParam("swLiveConnect","true");
sos.addParam("allowFullScreen","true");
sos.addParam("allowScriptAccess","always");
sos.write($("#_nj_uploader_direct_swf"+_h)[0]);
this._uploadFlash=$("#directUploader"+_h)[0];
},getFlash:function(){return this._uploadFlash;
},uploadStart:function(){this._uploadFlash.uploadStart();
},uploadCancel:function(){this._uploadFlash.uploadCancel();
},_directUploadComplete:function(res){if(this.isSizeOk){var self=this;
var _res=$.parseJSON(res);
self._callback_func(_res);
}},_selectFileInfo:function(res){var self=this,o=this.options;
var size=(o.fileSizeMax==10485760)?"10MB":"1024KB";
var isSizeOk=true;
this.failFileName=[];
$.each(res,function(){if(parseInt(this.fileSize)>=o.fileSizeMax){self.failFileName.push(this.name);
setTimeout(function(){self._alert(CONST.MESSAGE.UPLOAD_EXT.replace("%SIZE%",size));
},1);
isSizeOk=false;
}});
this.isSizeOk=isSizeOk;
if(isSizeOk){setTimeout($.proxy(function(){this._uploadFlash.uploadStart();
},this),0);
}else{this._uploadFlash.uploadCancel();
return false;
}},setDirectButton:function(button){var _b=(typeof button!="undefined")?button:this._uploadBtn;
var bleft=_b.offset().left-$(".LyContents").offset().left+12.5;
_b.prev().css({width:_b.width(),marginLeft:_b.width()/2*-1,height:_b.height(),left:bleft,top:_b[0].offsetTop});
},_setCrop:function(){var self=this,o=this.options,uploadBtn=this._uploadBtn,sServer=(typeof STATIC_SERVER!="undefined")?STATIC_SERVER:"";
uploadBtn.bind("click.njUploader",function(e){var cropLayer=CONST.TEMPLATE.CROP(sServer).replace("%cropSize%",o.cropSize);
var layerLeft=($("body").width()-622)/2;
var layerTop=($("html, body").scrollTop()+40);
var getImageSize=function(oiw,oih,_oiw,_oih){var riw=oiw,rih=oih,riw525=true,rih350=true;
var oScaledSize=nj.getScaledSize({width:riw,height:rih},{width:525,height:350});
return{height:oScaledSize.height,width:oScaledSize.width,originalHeight:oih,originalWidth:oiw,ratio:(oiw/oScaledSize.width)};
};
var _uploadComplate=function(res){self.cropImageFileName=res.fileName;
self.cropImageThumbnailUrl=res.thumbnailUrl;
if($("#_nj_uploader_crop_image").length>0){$(".jcrop-holder").remove();
$("#_nj_uploader_crop_image").remove();
}$("#_nj_uploader_crop_preview").attr("src","");
var _iw=parseInt(res.imageResolution.split("x")[0]);
var _ih=parseInt(res.imageResolution.split("x")[1]);
var _oiw=parseInt(o.cropSize.split("x")[0]);
var _oih=parseInt(o.cropSize.split("x")[1]);
if(_iw<=_oiw||_ih<=_oih){self.isCrop=false;
$(".crop_preview").html('<img id="_nj_uploader_crop_preview" src='+res.url+' style="width:95px;height:95px;left0;top0">');
}else{self.isCrop=true;
var imgSize=self._cropImageSize=getImageSize(_iw,_ih,_oiw,_oih);
$(".img_cropper").prepend('<img id="_nj_uploader_crop_image" src='+res.url+' style="width:'+imgSize.width+"px;height:"+imgSize.height+'px;left0;top0">');
self.previewImage=$("#_nj_uploader_crop_preview");
self.previewImage.attr("src",res.url);
self.previewImage.css({width:imgSize.width,height:imgSize.height});
self.jcrop=$.Jcrop("#_nj_uploader_crop_image",{setSelect:[0,0,_oiw,_oih],minSize:[Math.min(Math.max(Math.ceil(_oiw/imgSize.ratio),15),_oiw),Math.min(Math.max(Math.ceil(_oih/imgSize.ratio),15),_oih)],sideHandles:false,onChange:$.proxy(self.showPreview,self),onSelect:$.proxy(self.showPreview,self),aspectRatio:1,allowSelect:false});
$(".img_cropper p").remove();
}};
self._cropLayer=$.modal(cropLayer,{opacity:80,dataCss:{width:672,height:607},overlayCss:{backgroundColor:"#000000"},onShow:function(dialog){$(".simplemodal-wrap").css({overflow:"visible"});
if(self.options.prevUpload){_uploadComplate(self.options.prevUpload);
}}});
var oFlashVars={buttonImageURL:sServer+"/matome_ver4/img/common/btn_upload.png"};
$("._jWriteImageUploadBtn1").njUploader({mode:"direct",_parentMode:"crop",url:"/media/upload",fileSizeMax:1048576,onFileSelect:function(res){self._selectFileInfo(res);
},onUploadError:function(e,res){var failFileName=CONST.MESSAGE.UPLOAD_FAIL;
if(typeof this.failFileName!="undefined"){if(this.failFileName.length>0){failFileName+="\n・"+this.failFileName.join("\n");
}}alert(failFileName);
},onUploadComplete:function(e,res){if(res.result=="false"){self._trigger("onUploadError",null,res);
return false;
}_uploadComplate(res);
self._trigger("onUploadComplete",null,res);
}});
$(".btnUpload").bind("click.njUploader",function(e){if(typeof self.cropImageFileName=="undefined"){alert(CONST.MESSAGE.SELECT_IMAGE);
return;
}if(self.isCrop){var data={fileName:self.cropImageFileName,height:Math.floor(self._cropArea.h*self._cropImageSize.ratio),width:Math.floor(self._cropArea.w*self._cropImageSize.ratio),x:Math.floor(self._cropArea.x*self._cropImageSize.ratio),y:Math.floor(self._cropArea.y*self._cropImageSize.ratio)};
$.ajax({type:"POST",dataType:"json",url:"/media/crop",data:data,success:function(res){self._trigger("submit",null,res);
$.each(self._cropLayer.d,function(){if(this.hide){this.hide();
}});
},error:function(res){}});
}else{self._trigger("submit",null,{url:self.cropImageThumbnailUrl,result:true});
$.each(self._cropLayer.d,function(){if(this.hide){this.hide();
}});
}});
$(".layerClose").click(function(e){e.preventDefault();
self._cropLayer.close();
});
});
},_setMulti:function(){var self=this,o=this.options,uploadBtn=this._uploadBtn,sServer=(typeof STATIC_SERVER!="undefined")?STATIC_SERVER:"",headTitleTxt=document.title;
o.flashVars.uploadURL+=encodeURIComponent("&wl=true");
var _loadApi=$.extend(new nj.matome.common.RequestClient(),{locationCount:function(o){return this.request({requester:"rest",method:"get",url:nj.common.getAPI("MATOME_EDIT.LOCATION.COUNT",o)});
}});
uploadBtn.bind("click.njUploader",function(e){e.preventDefault();
var multiLayer=CONST.TEMPLATE.MULTI(sServer);
var layerLeft=($("body").width()-622)/2;
var layerTop=($("html, body").scrollTop()+40);
self._multiLayer=$.modal(multiLayer,{opacity:80,dataCss:{width:672,height:607},overlayCss:{backgroundColor:"#000000"},onShow:function(dialog){$(".simplemodal-wrap").css({overflow:"visible"});
},onClose:function(dialog){var _elFlash=$("#multiUploader")[0];
_elFlash.uploadCancel();
if(nj.matome.mtmMultiUploader){nj.matome.mtmMultiUploader.uploadedFile=0;
}$.modal.close();
}});
$("input",$(".imageTitle")).njPlaceholder();
$("textarea",$(".introduction")).njPlaceholder();
$("#simplemodal-container").css({width:622});
var _fvars=[];
$.each(o.flashVars,function(key){_fvars.push(key+"="+this);
});
var _h=new Date().getTime();
var so=new SWFObject(_flashSrc,"multiUploader",o.flashSize.width,o.flashSize.height,"9.0.0");
so.addParam("data-na",CONST.NSTAT.MULTI_UPLOAD);
so.addParam("FlashVars",_fvars.join("&amp;"));
so.addParam("menu","false");
so.addParam("loop","false");
so.addParam("quality","high");
so.addParam("wmode","transparent");
so.addParam("swLiveConnect","true");
so.addParam("allowFullScreen","true");
so.addParam("allowScriptAccess","always");
so.write("_jFlashUploader");
document.title=headTitleTxt;
$(".layerClose").click(function(e){e.preventDefault();
self._multiLayer.close();
});
$("li",$(".imagesList")).live("mouseover.njUploader",function(e){$(this).addClass("hover");
});
$("li",$(".imagesList")).live("mouseout.njUploader",function(e){$(this).removeClass("hover");
});
$("p.locationSetting input").bind("change.njUploader",function(e){var $locationInput=$(this);
$locationInput.data("restCount",null);
if($locationInput.attr("checked")===undefined){return;
}_loadApi.locationCount({missionId:o.missionId}).success(function(oResult){var restCount=1000-oResult;
$locationInput.data("restCount",restCount);
if(restCount<=18){return nj.common.message.alert("MATOME_EDIT.LOCATION_OVER_UPLOAD",{num:restCount});
}});
}).data("restCount",null);
$(".btnEnd").bind("click.njUploader",function(e){e.preventDefault();
$("input",$(".imageTitle")).triggerHandler("focus.njPlaceholder");
$("textarea",$(".introduction")).triggerHandler("focus.njPlaceholder");
var _info=$(".info");
var _data=[];
var _titleInput=$("input",$(".imageTitle")),_introText=$("textarea",$(".introduction"));
var _title=(_titleInput.njGetPlaceholderValue())?_titleInput.njGetPlaceholderValue():"";
var _des=(_introText.njGetPlaceholderValue())?_introText.njGetPlaceholderValue():"";
var _location=$("p.locationSetting input").data("restCount");
document.title=headTitleTxt;
if(_title.length>100){alert(CONST.MESSAGE.OVER_TITLE);
return false;
}if(_des.length>300){alert(CONST.MESSAGE.OVER_COMMENT);
return false;
}var _cleateItemData={options:{title:null,description:null,locationCount:0,data:[]},init:function(oOptions){var options=$.extend(this.options,oOptions);
this._itemLength=options.data.length;
this._i=0;
this._butLatlng="0";
this._result=[];
if(this._itemLength===0){alert(CONST.MESSAGE.SELECT_IMAGE);
return false;
}else{$(".uploadStatus02").show();
return this._cleateData();
}},_cleateData:function(){var that=this,options=this.options,res=$.parseJSON(decodeURIComponent($(options.data[this._i]).val())),locationFlag=(options.locationCount===undefined||options.locationCount===null||this._i>=options.locationCount||res.lat===this._butLatlng||res.lng===this._butLatlng);
if(locationFlag){this._pushData(res,null);
return this._checkEnd();
}else{$.gmapV3.load();
$.gmapV3.ready(function(){nj.gmaps.geocoder({lat:res.lat,lng:res.lng,success:function(oResult){that._pushData(res,oResult[0]);
return that._checkEnd();
},error:function(status){if(status==="OVER_QUERY_LIMIT"){setTimeout(function(){return that._cleateData();
},200);
}else{that._pushData(res,null);
return that._checkEnd();
}}});
});
}},_pushData:function(oData,locationData){var options=this.options;
if(locationData!==null){locationData.zoom=nj.gmaps.setting.zoomLevel.get(locationData.type);
delete locationData.type;
}delete oData.lat;
delete oData.lng;
$.extend(oData,{title:options.title,description:options.description,location:locationData});
this._result.push(oData);
return false;
},_checkEnd:function(){if(this._i<this._itemLength-1){this._i+=1;
return this._cleateData();
}else{this._i+=1;
return this._submitEnd();
}},_submitEnd:function(){self._trigger("submit",null,{result:this._result});
$(".uploadStatus02").hide();
return false;
}};
_cleateItemData.init({title:_title,description:_des,locationCount:_location,data:_info});
return false;
});
});
},showPreview:function(coords){if(coords.w===0&&coords.h===0){var _x=(coords.x===0)?0:coords.x-45;
var _y=(coords.y===0)?0:coords.y-45;
var _x2=(coords.x===0)?45:coords.x;
var _y2=(coords.y===0)?45:coords.y;
this.jcrop.setSelect([_x,_y,_x2,_y2]);
}var rx=95/coords.w;
var ry=95/coords.h;
this.previewImage.css({width:Math.round(rx*this._cropImageSize.width)+"px",height:Math.round(ry*this._cropImageSize.height)+"px",marginLeft:"-"+Math.round(rx*coords.x)+"px",marginTop:"-"+Math.round(ry*coords.y)+"px"});
this._cropArea={w:coords.w,h:coords.h,x:coords.x,y:coords.y};
},_callback_func:function(_res){if(_res.result=="true"){this._trigger("onUploadComplete",null,_res.qa);
}else{this._trigger("onUploadError",null,_res);
}},_alert:function(sMessage){this._uploadFlash.uploadCancel();
setTimeout(function(){alert(sMessage);
},300);
}};
})());
})(jQuery);
nj.getPackage("nj.matome.mtmMultiUploader",{msg:{UPLOAD_FAIL:"10MB未満のJPG、JPEG、GIF、PNGのみに対応しています。",UPLOAD_LIMIT:"一度にアップロードできる画像は#max#枚までです。"},CONST:{MAX_FILE_NUM:18},uploadFileList:undefined,fileNum:0,nowFile:0,uploadedFile:0,_elFlashObject:undefined,_aUploadFailImage:[],imgTemplate:function(className,imgSource,infoValue){return'<li class="'+className+'"><img width="89" height="89" border="0" alt="" src="'+imgSource+'"><button type="button" class="btnDelete"><span>削除</span></button><input type="hidden" class="info" value='+encodeURIComponent(infoValue)+"></li>";
},uploading:function(res){var self=this;
if(this.fileNum>self.CONST.MAX_FILE_NUM){var fnDelay=function(){var mes=self.msg.UPLOAD_LIMIT.replace("#max#",self.CONST.MAX_FILE_NUM);
alert(mes);
self._loading(false);
};
setTimeout(fnDelay,300);
this._elFlashObject.uploadCancel();
return;
}var r=$.parseJSON(res);
this.uploadedFile++;
$(".uploadStatusInfo").html("<em>"+(++this.nowFile)+"</em>/"+this.fileNum);
var _qas=[];
$.each(r.qa,function(k){_qas.push('"'+k+'":"'+this+'"');
});
if((this.CONST.MAX_FILE_NUM<=this.uploadedFile-1)||(r.result=="false")){this._elFlashObject.uploadCancel();
this._aUploadFailImage=[];
for(var i=this.nowFile-1;
i<this.fileNum;
i++){this._aUploadFailImage.push(this.uploadFileList[i].name);
}this._loading(false);
this.failImage(this._aUploadFailImage);
return;
}var temp=this.imgTemplate("",r.qa.url,"{"+_qas.join(",")+"}");
$(".imagesList").append(temp);
if(this.fileNum<=this.nowFile){var errorUpload=function(){self.failImage(self.uploadFileList);
self._loading(false);
};
setTimeout(errorUpload,300);
this._elFlashObject.uploadCancel();
}this._collect();
},_collect:function(){var _liImage=[];
var aElements=$("input.info",$(".imagesList"));
$.each(aElements,function(){_liImage.push($.parseJSON(decodeURIComponent($(this).val())));
});
this.liImage=_liImage;
this.uploadedFile=this._imgCount=(_liImage&&_liImage.length)?_liImage.length:0;
},_imgDelete:function(e){$($(e.target).parent()).remove();
},_loading:function(bload){if(bload){$(".uploadStatus").show();
}else{$(".uploadStatus").hide();
}},uploadStart:function(res){var ups=$(".uploadStatus"),_il=$(".imagesList").children("li"),self=this;
this.uploadFileList=res;
this._aUploadFailImage=[];
this.fileNum=res.length;
this.nowFile=0;
this._elFlashObject=$("#multiUploader")[0];
$(".uploadStatusInfo").html("<em>0</em>/"+((res.length>18)?18:res.length));
this._loading(true);
$(".btnDelete",$(".imagesList")).live("click.njUploader",function(e){self._imgDelete(e);
self._collect();
});
},failImage:function(oImages){var self=this,oi=oImages,nf=this.nowFile,fi=this._aUploadFailImage,nEmpty=0;
if(fi.length>0){if(self.CONST.MAX_FILE_NUM<=self.uploadedFile-1){var mes=self.msg.UPLOAD_LIMIT.replace("#max#",this.CONST.MAX_FILE_NUM)+"\n";
}else{var mes=self.msg.UPLOAD_FAIL+"\n";
}for(var i=0;
i<fi.length;
i++){if(fi[i]&&fi[i].length>0){mes+="・"+fi[i]+"\n";
}else{nEmpty++;
}}if(nEmpty>0){mes+="・ファイル名が確認不可:"+nEmpty+"枚";
}this._elFlashObject.uploadCancel();
setTimeout(function(){alert(mes);
},300);
}},fileFilter:function(){return[["Images (*.jpg, *jpeg, *.gif, *.png)","*.jpg;*.jpeg;*.gif;*.png;"]];
},uploadError:function(code,message){var self=this;
this._aUploadFailImage.push(this.uploadFileList[this.nowFile].name);
this.uploadedFile++;
if(this.nowFile<=this.uploadedFile){var fnDelay=function(){self.failImage(self._aUploadFailImage);
self._loading(false);
};
setTimeout(fnDelay,300);
this._elFlashObject.uploadCancel();
}}});


/* @release 1382429670 */