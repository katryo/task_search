(function($,undefined){$.widget("ui.suggestTopic",{options:{layerId:"suggestLayer2",addBtn:"INPUT.mdBtn01Add03Btn",layerToggle:"",position:{my:"left top",at:"left bottom",collision:"none"},cookieDomain:"",cookieName:"",autofocus:true,disabled:false,type:0,maxLength:14},_create:function(){var self=this,doc=this.element[0].ownerDocument;
var _cookie=$.cookie(this.options.cookieName);
this.options.disabled=(_cookie&&_cookie=="unuse")?true:false;
this.watch=new $.ui.watchinput;
this.watch.options={input:function(event,ui){if(self.options.disabled){return;
}self._input(event);
}};
this.watch.element=this.element;
this.watch._create();
this.element.attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.suggest",function(event){var keyCode=$.ui.keyCode;
switch(event.keyCode){case keyCode.PAGE_UP:case keyCode.PAGE_DOWN:case keyCode.LEFT:case keyCode.RIGHT:break;
case keyCode.UP:self._move("previous",event);
break;
case keyCode.DOWN:self._move("next",event);
break;
case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(self.options.type){if(!self.menu.active){return false;
}self._trigger("select",event,{item:self.menu.active.data("item.suggest")});
}else{if(self.menu.active){self._trigger("select",event,{item:self.menu.active.data("item.suggest")});
}else{self._trigger("select",event,{item:{value:self.element.val(),term:self.term}});
}}event.stopPropagation();
self.close(event);
break;
case keyCode.ESCAPE:self.element.val(self.term);
self.close(event);
break;
default:break;
}}).bind("blur.suggest",function(event){clearTimeout(self.searching);
self.closing=setTimeout(function(){self.close(event);
self._change(event);
},150);
}).bind("mousedown.suggest",function(){if(self.element.val().length>0){if(self.element.attr("placeholder")!==self.element.val()){self.open();
}}});
this._initSource();
this.response=function(){return self._response.apply(self,arguments);
};
this.menu=$("#"+this.options.layerId).mousedown(function(event){var menuElement=self.menu.element[0];
if(event.target===menuElement){setTimeout(function(){$(document).one("mousedown",function(event){if(event.target!==self.element[0]&&event.target!==menuElement&&!$.ui.contains(menuElement,event.target)){self.close();
}});
},1);
}setTimeout(function(){clearTimeout(self.closing);
},13);
}).suggestLayer2({base:self.element.parent(),disabled:self.options.disabled,position:self.options.position,focus:function(event,ui){var item=ui.item.data("item.suggest");
if(false!==self._trigger("focus",null,{item:item})){if(/^key/.test(event.originalEvent.type)){self.watch.disable(true);
self.element.val(item.value);
self.watch.disable(false);
}}},selected:function(event,ui){var item=ui.item.data("item.suggest"),previous=self.previous;
if(self.element[0]!==doc.activeElement){self.element.focus();
self.previous=previous;
}if(false!==self._trigger("select",event,{item:item,term:self.term})){self.term=item.value;
self.watch.disable(true);
if(!self.options.type){self.element.val(item.value);
}self.watch.disable(false);
}self.close(event);
self.selectedItem=item;
},blur:function(event,ui){},enable:function(event,ui){self._disable(false,event);
},disable:function(event,ui){self._disable(true,event);
}}).zIndex(this.element.zIndex()+999).css({top:0,left:0}).hide().data("ui-suggestLayer2");
var layerToggle=$(self.options.layerToggle);
layerToggle.mousedown(function(event){event.preventDefault();
if(!self.menu.element.is(":visible")){self.open();
}else{self.close();
}}).click(function(event){event.preventDefault();
});
if(this.options.autofocus){self._setAutoFocus();
}self._disable(self.options.disabled,null);
if($.fn.bgiframe){this.menu.element.bgiframe();
}},_setAutoFocus:function(){$(document).keydown($.proxy(function(event){var _target=event.target;
var cancelTag={INPUT:1,TEXTAREA:1,SELECT:1,EMBED:1,OBJECT:1};
var keyCode=$.ui.keyCode;
var code=event.keyCode;
var _name=_target.tagName?_target.tagName.toUpperCase():"";
if(!cancelTag[_name]||(event.ctrlKey&&code!==86)){if(code==224||code==116||event.metaKey||code===keyCode.BACKSPACE||(code>=keyCode.SPACE&&code<=keyCode.DOWN)||(code!=21&&code<keyCode.SPACE)||event.altKey){return;
}if(code===keyCode.SPACE&&event.shiftKey){window.scrollTo(0,0);
this.element.focus();
this.element.select();
event.preventDefault();
}else{if(_target!=this.element[0]){window.scrollTo(0,0);
this.element.focus();
this.element.select();
this._input(event);
}}}},this));
},_input:function(event){var self=this;
clearTimeout(self.searching);
self.searching=setTimeout(function(){if(self.element.val().length<1){self.close();
}if(self.term!=self.element.val()){self.selectedItem=null;
self.search(null,event);
}},self.options.delay);
},_disable:function(isDisable,event){$.cookie(this.options.cookieName,((isDisable)?"unuse":"use"),{expires:(new Date((new Date()).getTime()+21900*1000*60*60*24)),domain:this.options.domain});
this.options.disabled=isDisable;
this.element.attr("autocomplete",((isDisable)?"on":"off"));
if(!isDisable&&event){this.search(null,event);
}},_initSource:function(){var self=this,array,url;
if($.isArray(this.options.source)){array=this.options.source;
this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));
};
}else{if(typeof this.options.source==="string"){url=this.options.source;
this.source=function(request,response){if(self.xhr){self.xhr.abort();
}self.xhr=$.getJSON(url,request,function(data,status,xhr){if(xhr===self.xhr){response(data);
}self.xhr=null;
});
};
}else{this.source=this.options.source;
}}},search:function(value,event){value=value!=null?value:this.element.val();
if(value.length<1){return false;
}this.term=this.element.val();
if(value.lengt_triggerh<this.options.minLength){return this.close(event);
}clearTimeout(this.closing);
if(this._trigger("search")===false){return;
}return this._search(value);
},_search:function(value){this.element.addClass("ui-autocomplete-loading");
this.source({term:value},this.response);
},_response:function(content){if(content.length){content=this._normalize(content);
this._suggest(content);
this._trigger("open");
}else{this.menu.ul.empty();
this.menu.deactivate();
this.menu.refresh();
if(this.element.val().length==0&&this.menu.element.is(":visible")){this.close();
}else{this.menu.show();
}}this.element.removeClass("ui-autocomplete-loading");
},close:function(event){clearTimeout(this.closing);
if(this.menu.element.is(":visible")){this.menu.hide();
this._trigger("close",event);
}},_change:function(event){if(this.previous!==this.element.val()){this._trigger("change",event,{item:this.selectedItem});
}},_normalize:function(items){return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};
}else{return{label:item[5],value:item[5],name:item[5],id:item[1],count:item[3],officialFlag:(item[4]==="1")?true:false};
}});
},_suggest:function(items){var ul=this.menu.ul.empty().zIndex(this.element.zIndex()+1),menuWidth,textWidth;
this._renderMenu(ul,items);
this.menu.deactivate();
this.menu.refresh();
this.open();
},open:function(){this.menu.show();
var ul=this.menu.ul,menuWidth=ul.width("").outerWidth(),textWidth=$(this.options.layerSize).outerWidth();
ul.outerWidth(Math.max(menuWidth,textWidth));
},_renderMenu:function(ul,items){var self=this;
$.each(items,function(index,item){self._renderItem(ul,item);
});
},_renderItem:function(ul,item){var itemText=nj.cutString(item.label,this.option("maxLength"),"…");
return $('<li data-na="NC:suggesttopic" class="mdSuggest02Li"></li>').data("item.suggest",item).append($('<span class="mdSuggest02Txt"></span>').text(itemText)).append('<span class="mdSuggest02Option01"><span class="mdSuggest02Option01Num">'+item.count+'</span><span class="mdSuggest02Option01Unit">まとめ</span></span>').appendTo(ul);
},_move:function(direction,event){if(this.menu.ul.is(":empty")){return;
}if(!this.menu.element.is(":visible")){if(/^next/.test(direction)){this.search(null,event);
}return;
}if(this.menu.last()&&/^next/.test(direction)){return;
}if(this.menu.first()&&/^previous/.test(direction)){this.element.val(this.term);
this.close();
return;
}this.menu[direction](event);
}});
}(jQuery));
(function($){$.widget("ui.suggestLayer2",{options:{base:null,inner:"suggestDtl",listbox:"mdSuggest02List",messagebox1:"guideText",messagebox2:"guideText2",on:"suggestOn",off:"suggestOff",position:{my:"left top",at:"left bottom",collision:"none"},disabled:false},_create:function(){var self=this;
$("."+this.options.on,this.element).click(function(event){event.preventDefault();
event.stopPropagation();
self.options.disabled=false;
self._status();
self._trigger("enable",event,{});
});
$("."+this.options.off,this.element).click(function(event){event.preventDefault();
event.stopPropagation();
self.options.disabled=true;
self._status();
self._trigger("disable",event,{});
});
this.detail=$("."+this.options.inner,this.element);
this.ul=$("."+this.options.listbox,this.element);
this.ul.click(function(event){if(!$(event.target).closest(".mdSuggest02Li").length){return;
}event.preventDefault();
self.select(event);
});
this.refresh();
$(window).resize($.proxy(self._setPosition,self));
},refresh:function(){var self=this;
var items=this.ul.children("li").addClass("mdSuggest02Li").attr("role","menuitem").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this));
}).mouseleave(function(){self.deactivate();
});
this._status();
},activate:function(event,item){this.deactivate();
if(this.hasScroll()){var offset=item.offset().top-this.ul.offset().top,scroll=this.ul.scrollTop(),elementHeight=this.ul.height()-6;
if(offset<0){this.ul.scrollTop(scroll+offset);
}else{if(offset>=elementHeight){this.ul.scrollTop(scroll+offset-elementHeight+item.height());
}}}this.active=item.eq(0).addClass("ExSelected").attr("id","ui-active-menuitem").end();
this._trigger("focus",event,{item:item});
},deactivate:function(){if(!this.active){return;
}this.active.removeClass("ExSelected").removeAttr("id");
this._trigger("blur");
this.active=null;
},next:function(event){this.move("next",".mdSuggest02Li:first",event);
},previous:function(event){this.move("prev",".mdSuggest02Li:last",event);
},first:function(){return this.active&&!this.active.prevAll(".mdSuggest02Li").length;
},last:function(){return this.active&&!this.active.nextAll(".mdSuggest02Li").length;
},move:function(direction,edge,event){if(!this.active){this.activate(event,this.ul.children(edge));
return;
}var next=this.active[direction+"All"](".mdSuggest02Li").eq(0);
if(next.length){this.activate(event,next);
}else{this.activate(event,this.ul.children(edge));
}},hasScroll:function(){var sOverflow=this.ul.css("overflow-y");
return sOverflow==="scroll"||sOverflow==="auto";
},select:function(event){this._trigger("selected",event,{item:this.active});
},show:function(){this.element.show();
this._status();
this._setPosition();
},hide:function(){this.element.hide();
this.deactivate();
},_setPosition:function(){if(this.element.is(":visible")){this.element.position($.extend({of:this.options.base},this.options.position));
}},_status:function(){if(this.options.disabled){this.detail.removeClass("list").addClass("disable");
return;
}else{this.detail.removeClass("disable");
}this.detail[this.ul.is(":empty")?"removeClass":"addClass"]("list");
}});
}(jQuery));
(function($,undefined){$.widget("ui.njTopicSuggest",$.ui.suggestTopic,{_create:function(){if($("#smartSearchLayer2").length>0){$("#smartSearchLayer2").remove();
}var suggestLayer='<!-- Suggest Layer --><div id="smartSearchLayer2" data-na="NA:topiclayer" class="MdSuggest02" style="display:none"><ul class="mdSuggest02List"></ul></div>';
$("body").append(suggestLayer);
$("#smartSearchLayer2").css("position","fixed");
var _super=new $.ui.suggestTopic;
this._create=_super._create;
this._create();
this._$menuElement=$(this.menu.element);
},open:function(){var ul=this.menu.ul,sEle=this.element.parent(),_top=sEle.outerHeight()+sEle.offset().top,_width=this.element.outerWidth();
this._$menuElement.css({top:_top,width:_width-2,left:sEle.offset().left});
if(ul.children().length>0){this.menu.show();
}else{this.close();
}}});
}(jQuery));
(function(){$.widget("ui.stopScroll",{_create:function(){if(this.element[0]===document.body){this._$html=$("html");
this._$win=$(window);
this._oCacheData={};
this._bIsMac=/mac/.test(navigator.platform.toLowerCase());
this._bIsWinFF=!this._bIsMac&&$.browser.mozilla;
}},_init:function(){this._disableKeyboardScrolling();
this._overflow(false);
},release:function(){this._enableKeyboardScrolling();
this._overflow(true);
},_overflow:function(bVisible){var nScrollTop,oCacheData=this._oCacheData,fChangeHeight;
if(bVisible){this.element.css("overflow-y",oCacheData.element.overflowY);
if(this._$html){this._$html.css("overflow-y",oCacheData.html.overflowY);
if($.browser.mozilla||this._bIsMac){this._$html.css({position:oCacheData.html.position,width:oCacheData.html.width});
this.element.css({position:oCacheData.element.position,top:oCacheData.element.top,width:oCacheData.element.width});
if(this._bIsMac){this._$html.css("height",oCacheData.html.height);
this.element.css("height",oCacheData.element.height);
this._$win.unbind("resize.stopScroll");
}this._$win.scrollTop(oCacheData.win.scrollTop);
}}}else{oCacheData.element={};
oCacheData.win={};
oCacheData.win.scrollTop=this._$win.scrollTop();
oCacheData.element.overflowY=this.element.css("overflow-y");
if(!this._bIsWinFF){this.element.css("overflow-y","hidden");
}if(this._$html){oCacheData.html={};
oCacheData.html.overflowY=this._$html.css("overflow-y");
this._$html.css("overflow-y","hidden");
if($.browser.mozilla||this._bIsMac){oCacheData.html.position=this._$html.css("position")||"";
oCacheData.html.width=this._$html[0].style.width||"";
oCacheData.element.position=this.element.css("absolute")||"";
oCacheData.element.top=this.element.css("top")||"";
oCacheData.element.width=this.element[0].style.width||"";
this._$html.css({position:"relative",width:"100%"});
this.element.css({position:"absolute",top:-oCacheData.win.scrollTop,width:oCacheData.element.width?oCacheData.element.width:"100%"});
if(this._bIsMac){oCacheData.html.height=this._$html[0].style.height||"";
oCacheData.element.height=this.element[0].style.height||"";
this._$html.css("height","100%");
fChangeHeight=(function($el,$win){return function(){$el.css("height",$win.height()+oCacheData.win.scrollTop);
};
})(this.element,this._$win);
fChangeHeight();
this._$win.bind("resize.stopScroll",fChangeHeight).trigger("resize");
}}}}this._oCacheData=oCacheData;
},_disableKeyboardScrolling:function(){this.element.bind("keydown",this._preventScrolling);
},_enableKeyboardScrolling:function(){this.element.unbind("keydown",this._preventScrolling);
},_preventScrolling:function(e){var keyCode=e.keyCode,keys=$.ui.keyCode;
if(e.type=="keypress"){return;
}if(keyCode===keys.DOWN||keyCode===keys.UP){var $el=$(e.target);
if(!isConsumesKeyboardEvents($el)){e.preventDefault();
}}}});
function isConsumesKeyboardEvents($e){return !($e.is(":button"))&&($e.is(":input")||$e.is("[contentEditable]"));
}$.extend((function(){var _$body,stopScrollBody;
stopScrollBody=function(){if(!_$body){_$body=$(document.body);
}_$body.stopScroll();
};
stopScrollBody.release=function(){if(!_$body){return;
}_$body.stopScroll("release");
};
return{stopScrollBody:stopScrollBody};
})());
})();
nj.getPackage("nj.matome.mtmTopicSuggest",(function(){var options={issuggest:true,params:{official:"1"}};
return{options:{},q:null,init:function(oOptions){var o=$.extend(this.options,options,oOptions);
if(o.issuggest){this._initSuggest(o.params);
}},_initSuggest:function(oParams){var _this=this;
this.q=$("#q2").njTopicSuggest({layerId:"smartSearchLayer2",layerSize:".mdLayer05Form01Inputbox",cookieDomain:"naver.jp",cookieName:"NaverSuggestUse",type:_this.options.Type,autofocus:false,source:function(request,response){if(request.term==this.element.attr("placeholder")){return false;
}var oData={q:request.term};
$.extend(true,oData,oParams);
$.ajax({url:_this.options.Url+"/ac",dataType:"jsonp",jsonp:"_callback",data:oData,success:function(json){var items=json.items;
if(items[0].length<1){response([]);
$("#smartSearchLayer2").hide();
}else{_data=[];
var aItems=[];
aItems=items[0];
$.each(aItems,function(i,v){if(typeof v!=="undefined"&&v){var _aTempInfo=v[1].split("{naver}");
_data.push([$.trim(v[0]).replace("$","$$"),_aTempInfo[0],_aTempInfo[1],_aTempInfo[2],_aTempInfo[3],_aTempInfo[4]]);
}});
response(_data);
}}});
},select:function(event,ui){if(ui.term){$('<input type="hidden" name="sme">').val(ui.term.length).appendTo($("#q")[0].form);
}if($("#sm")){$("#sm").value=(typeof gSuggestCodeSug!="undefined")?gSuggestCodeSug:"tab_sug.pre";
}$("#q2").val(ui.item.value);
if(_this.options.FnCallback){_this.options.FnCallback.apply(this,[ui.item]);
}}});
$(document).bind("click.matome_suggest",function(e){var isLayer=false;
$.each(["mdLayer05Form01Inputbox"],function(){isLayer=$(e.target).hasClass(this)||isLayer;
});
if(!isLayer){$("#smartSearchLayer2").hide();
}});
}};
})());
(function($){var template={layer:'<div data-na="NA:topiclayer" class="MdLayer05 MdLayerTopicWord01" style="display: none; z-index: 999;"><div class="mdLayer05Body"><div class="mdLayer05Form01"><fieldset><legend>トピック追加</legend><div class="mdLayer05Form01Add01"><p class="mdLayer05Form01Input"><input type="text" data-na="NL:keyword" value="" alt="検索" title="検索" accesskey="s" class="mdLayer05Form01Inputbox" placeholder="トピック名を入力してください。" name="q2" id="q2" role="textbox" aria-autocomplete="list" aria-haspopup="true" autocomplete="off"></p><p class="mdLayer05Form01Btn"><span class="MdBtn01Add03 ExDisabled"><input data-na="NC:add" type="button" value="追加" class="mdBtn01Add03Btn"></span></p></div></fieldset></div><dl class="mdLayerTopicWord01AddedList01"><dt class="mdLayerTopicWord01AddedList01Ttl">入力されたトピック</dt><dd class="mdLayerTopicWord01AddedList01Txt"><div class="MdTopicWordList01"><ul class="mdTopicWordList01Ul MdCF"></ul></div></dd></dl></div><div class="mdLayer05Foot"><p class="mdLayer05FootBtn"><span class="MdBtn01Save02"><a data-na="NC:save" href="" class="mdBtn01Save02Btn">保存</a></span><span class="MdBtn01Cancel01"><a data-na="NC:cancel" href="#" class="mdBtn01Cancel01Btn simplemodal-close">キャンセル</a></span></p></div><div class="mdLayer05Suggest01" style="display:none;"><ul class="mdLayer05Suggest01List"></ul></div></div>',boardLayer:'<div data-na="NA:topiclayer" class="MdLayer05 MdLayerTopicWord01" style="display: none; z-index: 999;"><div class="mdLayer05Body"><div class="mdLayer05Form01"><fieldset><legend>トピック追加</legend><div class="mdLayer05Form01Add02 MdCF"><p class="mdLayer05Form01Input"><input type="text" data-na="NL:keyword" value="" alt="検索" title="検索" accesskey="s" class="mdLayer05Form01Inputbox" placeholder="トピック名を入力してください。" name="q2" id="q2" role="textbox" aria-autocomplete="list" aria-haspopup="true" autocomplete="off"></p><p class="mdLayer05Form01Btn"></p></div></fieldset></div><dl class="mdLayerTopicWord01AddedList01"><dt class="mdLayerTopicWord01AddedList01Ttl">入力されたトピック</dt><dd class="mdLayerTopicWord01AddedList01Txt"><div class="MdTopicWordList01"><ul class="mdTopicWordList01Ul MdCF"></ul></div></dd></dl></div><div class="mdLayer05Foot"><p class="mdLayer05FootBtn"><span class="MdBtn01Save02"><a data-na="NC:save" href="" class="mdBtn01Save02Btn">保存</a></span><span class="MdBtn01Cancel01"><a data-na="NC:cancel" href="#" class="mdBtn01Cancel01Btn simplemodal-close">キャンセル</a></span></p></div><div class="mdLayer05Suggest01" style="display:none;"><ul class="mdLayer05Suggest01List"></ul></div></div>',layer_item:'<li class="mdTopicWordList01Li"><span class="MdTopicWord01"><span class="_tag">${Topic}</span><span class="mdTopicWord01Del01"><input data-na="NC:delete" type="button" value="" class="mdTopicWord01Del01Btn" title="削除"></span></span></li>',item:'<li class="mdTopicWordList01Li"><a href="/topic/${TopicId}" class="MdTopicWord01">${Topic}</a></li>',missionCount:'<span class="mdTopicWord01Num">(${MissionCount})</span></a>'};
$.widget("matome.mtmTopic",(function(){$PROTOTYPE=(function(){var CONST={LAYER:"DIV.MdLayer05.MdLayerTopicWord01",SAVE_BTN:"DIV.MdLayer05.MdLayerTopicWord01 A.mdBtn01Save02Btn",CANCLE_BTN:"DIV.MdLayer05.MdLayerTopicWord01 A.mdBtn01Cancel01Btn",LIST_ROOT:"DIV.MdLayer05.MdLayerTopicWord01 UL.mdTopicWordList01Ul.MdCF",INPUT:"DIV.MdLayer05.MdLayerTopicWord01 INPUT.mdLayer05Form01Inputbox",ADD_BTN:"DIV.MdLayer05.MdLayerTopicWord01 INPUT.mdBtn01Add03Btn",TOPIC_ELEM:"SPAN.MdTopicWord01",ERROR:{NGWORD_CHK:"登録できない文字が含まれています。 ",TEXT_LIMIT:"25文字以内で入力してください。",COUNT_LIMIT:'{{if Type === "relativeC"}}トピックには関連トピックを{{else}}まとめにはトピックを{{/if}}${Limit}個まで設定できます。',DUPLE:"トピック名と同じ内容は登録できません。",DUPLE_C:"当該トピックと同一のトピックは設定できません。",DUPLE_P:"当該トピックと同一のトピックは設定できません。",INPUT_LIMIT:"すでに登録済みの内容です。",TEXT_CHK:"サジェスト表示されたトピックのみ登録できます。",SAVE:"「入力したトピック」の内容を保存します。入力Boxに入力されたキーワードは、追加ボタンを押さないと登録されません。",SERVER:"一時的な問題により、アクセスできません。しばらくしてからもう一度お試しください。",SESSION:"一定時間動作がなかったためセッションが切れました。再度ログインしてください。"}};
var API={MATOME:"/api/tag/matome",SIMILAR:"/api/tag/similar",RELATIVE_P:"/api/tag/relative/P",RELATIVE_C:"/api/tag/relative/C",NG_CHECK:"/api/tag/check",GET:{MATOME:"/api/tag/matome/",RELATIVE_C:"/api/tag/relative/C/",RELATIVE_P:"/api/tag/relative/P/"}};
var LABEL={OVER_MISSION_COUNT:"999999+"};
return{_layerID:"",_currentData:null,_layer:null,_layerModal:null,options:{TopicsRoot:"",AddBtn:"",Gnb:".MdHeadUtil01",params:{},maxLength:10},_create:function(){this._createSuggest();
this._elWindow=$(window);
this._elRoot=$.browser.webkit?document.body:document.getElementsByTagName("html")[0];
$(this.options.AddBtn).click($.proxy(function(e){e.preventDefault();
this._show();
return false;
},this));
},_createSuggest:function(){if(typeof suggestOption=="undefined"){suggestOption={};
}},_attachEvent:function(){var self=this;
var _elInput=$(CONST.INPUT);
$(CONST.ADD_BTN).click($.proxy(function(e){e.preventDefault();
this._set();
return false;
},this));
$(CONST.SAVE_BTN).click($.proxy(function(e){e.stopPropagation();
this._save();
return false;
},this));
_elInput.bind("input propertychange",function(e){if(self.options.Type=="matome"){self._chagneAddBtnState();
}});
},_show:function(){var self=this;
if($.cookie("NJID_AUT")==null){var loginOptions={loginDomain:g_loginDomain,loginApi:g_loginApi,proxyUrl:g_proxyUrl,rsaKeysApi:g_rsaKeysApi,success:function(){$(self.options.Gnb).html(G_HEADER_LOGON_TEMPLATE);
setTimeout(function(){window.location.reload();
},800);
}};
window.g_callback=function(){$(self.options.Gnb).html(G_HEADER_LOGON_TEMPLATE);
setTimeout(function(){window.location.reload();
},800);
};
$(self.options.AddBtn).njLogin(loginOptions);
$(self.options.AddBtn).njLogin("view");
return false;
}self._refresh("layer");
},_showModal:function(oTopics){var self=this,_layerModal=null;
function __select(oData){if(self.options.Type=="matome"){self._set();
}else{if(!self._isTopicSizeChk()){return false;
}if(!self._isDuplecation(oData.name)){return false;
}self._insert(oData,"layer");
self._getLayerPosition($(self._layerModal).width(),$(self._layerModal).height(),$("#simplemodal-container"));
}return false;
}if(this.options.Type=="matome"){this._layerModal=$(template.layer);
}else{this._layerModal=$(template.boardLayer);
}$(this._layerModal).modal($.extend({},{focus:false,overlayClose:false,escClose:false,opacity:50,autoPosition:false,overlayCss:{backgroundColor:"#000"},onShow:function(dialog){if(!$.browser.mozilla){$(CONST.INPUT).njPlaceholder();
}$.each(oTopics,$.proxy(function(index,item){self._insert(item,"layer");
},this));
self._attachEvent();
self._getLayerPosition($(self._layerModal).width(),$(self._layerModal).height(),dialog.container);
self._elWindow.resize(function(){self._getLayerPosition($(self._layerModal).width(),$(self._layerModal).height(),dialog.container,self.options.Type!=="relativeC");
});
},onClose:function(o){$("#smartSearchLayer2").remove();
$(self._elWindow).unbind("resize");
$.modal.close();
}}));
if(this.options.Type=="matome"){nj.matome.mtmTopicSuggest.init({Type:0,FnCallback:__select,Url:SUGGEST_URL,params:this.option("params")});
}else{nj.matome.mtmTopicSuggest.init({Type:1,FnCallback:__select,Url:SUGGEST_URL,params:this.option("params")});
}},_getLayerPosition:function(_nWidth,_nHeight,_oElem,bOnlyLeft){var _nLeft,_nTop=0;
var _nWindowWidth=this._elWindow.width();
var _nWindowHeight=this._elWindow.height();
var _oAddBtn=$(this.options.AddBtn);
var elFloatingHeader,oOffset,nHeight,nScrollLeft,o;
if(this.options.Type=="relativeC"){var _oRelativeCElem=$(".MdTopicRelated01 .mdTopicBoard01Ttl01");
oOffset=_oRelativeCElem.offset();
_nLeft=oOffset.left;
_nTop=oOffset.top+parseInt(_oRelativeCElem.height())-this._elRoot.scrollTop;
nHeight=_nTop+_oElem.find(".MdLayer05").height();
if(nHeight>_nWindowHeight){_nTop-=nHeight-_nWindowHeight;
}nScrollLeft=this._elWindow.scrollLeft();
if((oOffset.left+_nWidth)>(_nWindowWidth+nScrollLeft)){_nLeft=(nScrollLeft+_nWindowWidth)-_nWidth-10;
}}else{oOffset=_oAddBtn.offset();
nScrollLeft=this._elWindow.scrollLeft();
_nLeft=oOffset.left-nScrollLeft;
if((oOffset.left+_nWidth)>(_nWindowWidth+nScrollLeft)){_nLeft=_nWindowWidth-_nWidth-nScrollLeft-10;
}else{_nLeft+=nScrollLeft;
}elFloatingHeader=$(".mdMTMViewHead01Fixed");
if(elFloatingHeader.length){elFloatingHeader.removeClass("mdMTMViewHead01Fixed");
_nTop=_oAddBtn.offset().top;
elFloatingHeader.addClass("mdMTMViewHead01Fixed");
_nTop-=parseInt(_oAddBtn.outerHeight(true));
}else{_nTop=oOffset.top+parseInt(_oAddBtn.outerHeight(true));
}}var nOverLeft=_nLeft+_oElem.width()-_nWindowWidth;
if(nOverLeft>0){_nLeft-=nOverLeft;
}else{if(_nLeft<30){_nLeft=30;
}}o={left:_nLeft,height:"auto"};
!bOnlyLeft&&(o.top=_nTop);
_oElem.css(o);
},_getTopicInputValue:function(){if($(CONST.INPUT).attr("placeholder")===$(CONST.INPUT).njGetPlaceholderValue()){return"";
}return fnMatome.trim($(CONST.INPUT).njGetPlaceholderValue(),true);
},_isLengthChk:function(sTopic){if(sTopic==$(CONST.INPUT).attr("placeholder")){return false;
}if(sTopic.length<1){return false;
}if(sTopic.length>25){this._error("alert",CONST.ERROR.TEXT_LIMIT);
return false;
}return true;
},_isTopicSizeChk:function(){if($(CONST.LIST_ROOT).find(CONST.TOPIC_ELEM).length>this.options.Limit-1){var _msg=String($.tmpl(CONST.ERROR.COUNT_LIMIT,{Limit:this.options.Limit,Type:this.options.Type}).text());
this._error("alert",_msg);
return false;
}return true;
},_isDuplecation:function(sTopic){var _sTopic=sTopic.toLowerCase();
var _aTags=$(CONST.LIST_ROOT).find(CONST.TOPIC_ELEM);
for(var i=0;
i<_aTags.length;
i++){if($(_aTags[i]).parent().data("item.data").name.toLowerCase()==_sTopic){this._error("alert",CONST.ERROR.INPUT_LIMIT);
$(CONST.INPUT).njSetPlaceholderValue("");
$(CONST.INPUT).focus();
return false;
break;
}}return true;
},_set:function(){var _sTopic=this._getTopicInputValue();
if(!this._isLengthChk(_sTopic)){return false;
}if(!this._isTopicSizeChk()){return false;
}if(!this._isDuplecation(_sTopic)){return false;
}this._getTopic(_sTopic);
},_chagneAddBtnState:function(){if(this._getTopicInputValue()===""||(this._getTopicInputValue()==$(CONST.INPUT).attr("placeholder"))){$(CONST.ADD_BTN).attr("disabled",true).parent().addClass("ExDisabled");
}else{$(CONST.ADD_BTN).attr("disabled",false).parent().removeClass("ExDisabled");
}},_getTopic:function(sTopic){var self=this;
var _officialFlag=false;
var _data=null;
var _sTopic=sTopic;
this._chagneAddBtnState();
nj.matome.mtmAPIRequester.request({requester:"rest",method:"GET",url:nj.replaceStr(API.NG_CHECK,{}),data:{q:_sTopic},onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._serverError(oResponse.error);
return false;
}else{_data=oResponse.result;
if(_data.ng){self._error("alert",CONST.ERROR.NGWORD_CHK);
}else{self._insert({name:_sTopic,officialFlag:_data.officialFlag},"layer");
}}},this),onError:$.proxy(function(){self._error("alert",CONST.ERROR.SERVER);
},this)});
},_serverError:function(oError){if(oError.code==="16001"){if(this.options.Type=="relativeC"){this._error("alert",CONST.ERROR.DUPLE_C);
}else{if(this.options.Type=="relativeP"){this._error("alert",CONST.ERROR.DUPLE_P);
}else{if(this.options.Type=="matome"){this._error("alert",CONST.ERROR.DUPLE);
}}}}else{if(oError.code==="401"){this._error("alert",CONST.ERROR.SESSION);
goLogin();
}else{this._error("alert",CONST.ERROR.SERVER);
}}return false;
},_insert:function(oData,sType){var _elTag=null,elTopicWord=null,nMaxLength=this.option("maxLength"),_sTopic=nj.cutString(oData.name,nMaxLength,"…"),nMissionCount=0,admitType=oData.admit;
if(sType=="layer"){_elTag=$(template.layer_item).data("item.data",oData);
_elTag.find("INPUT.mdTopicWord01Del01Btn").click($.proxy(function(e){e.preventDefault();
this._delete($(e.currentTarget).parent().parent().parent());
return false;
},this)).end().find("SPAN._tag").text(_sTopic);
if(oData.officialFlag===true&&admitType===1){_elTag.find("SPAN.MdTopicWord01").addClass("mdTopicWord01Official");
_elTag.find("SPAN.mdTopicWord01Del01").remove();
}else{if(oData.officialFlag===true&&admitType===2){_elTag.find("SPAN.MdTopicWord01").addClass("mdTopicWord01Official");
_elTag.find("SPAN.mdTopicWord01Del01").remove();
}else{if(oData.officialFlag===false){_elTag.find("SPAN.MdTopicWord01").addClass("mdTopicWord01Unofficial");
}}}$(CONST.LIST_ROOT).append(_elTag);
}else{_elTag=$.tmpl(template.item,{TopicId:oData.base62TagId});
elTopicWord=_elTag.find("A.MdTopicWord01");
if(String(oData.name).length>nMaxLength){elTopicWord.attr("title",oData.name).text(_sTopic);
}else{elTopicWord.text(_sTopic);
}if(oData.officialFlag===true&&admitType===1){_elTag.find(".MdTopicWord01").addClass("mdTopicWord01Official");
}else{if(oData.officialFlag===true&&admitType===2){_elTag.find(".MdTopicWord01").addClass("mdTopicWord01Official");
}else{if(oData.officialFlag===false){_elTag.find(".MdTopicWord01").addClass("mdTopicWord01Unofficial");
}}}if(oData.officialFlag===true){nMissionCount=oData.missionCount>999999?LABEL.OVER_MISSION_COUNT:oData.missionCount;
elTopicWord.append($.tmpl(template.missionCount,{MissionCount:nMissionCount}));
}$(this.options.TopicsRoot).append(_elTag);
}if(this._getTopicInputValue()!==""){$(CONST.INPUT).njSetPlaceholderValue("");
$(CONST.INPUT).focus();
}this._chagneAddBtnState();
},_save:function(){var self=this;
var _apiUrl="";
var TOPIC_DATA=null;
if(!this._saveChk(this.options.Type)){return false;
}if(this.options.Type=="matome"){_apiUrl=API.MATOME;
var _aTags=[];
$.each($(CONST.LIST_ROOT).find("LI"),$.proxy(function(index,item){_aTags.push($(item).data("item.data").name);
},this));
TOPIC_DATA={missionId:g_missionId,names:_aTags};
}else{if(this.options.Type=="relativeC"){_apiUrl=API.RELATIVE_C;
}else{_apiUrl=API.RELATIVE_P;
}var _aRelativeTagIds=[];
$.each($(CONST.LIST_ROOT).find("LI"),$.proxy(function(index,item){_aRelativeTagIds.push(($(item).data("item.data").id)?$(item).data("item.data").id:$(item).data("item.data").tagId);
},this));
TOPIC_DATA={tagId:TAG_ID,relativeTagIds:_aRelativeTagIds};
}$.modal.close();
nj.matome.mtmAPIRequester.request({requester:"rest",method:"post",url:nj.replaceStr(_apiUrl,{}),data:TOPIC_DATA,onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._serverError(oResponse.error);
return false;
}else{var _data=null;
$(this.options.TopicsRoot).html("");
if(self.options.Type=="matome"){_data=oResponse.result.tags;
}else{_data=oResponse.result.relativeTags;
}$.each(_data,$.proxy(function(index,item){self._insert(item,"page");
},this));
}},this),onError:$.proxy(function(){self._error("alert",CONST.ERROR.SERVER);
$.modal.close();
return false;
},this)});
},_saveChk:function(type){if(this._getTopicInputValue()==$(CONST.INPUT).attr("placeholder")){return true;
}if(this._getTopicInputValue()==""){return true;
}if(type=="matome"){this._error("alert",CONST.ERROR.SAVE);
return true;
}else{this._error("alert",CONST.ERROR.TEXT_CHK);
return false;
}},_refresh:function(sType){var self=this;
var _url="";
if(this.options.Type=="matome"){_url=API.GET.MATOME+g_missionId;
}else{if(this.options.Type=="relativeC"){_url=API.GET.RELATIVE_C+TAG_ID;
}else{if(this.options.Type=="relativeP"){_url=API.GET.RELATIVE_P+TAG_ID;
}}}nj.matome.mtmAPIRequester.request({requester:"rest",method:"GET",url:nj.replaceStr(_url,{}),data:{},onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._serverError(oResponse.error);
return false;
}else{var _data=oResponse.result;
if(sType==="layer"){self._showModal((self.options.Type!="matome")?_data.relativeTags:_data.tags);
return false;
}if(sType==="page"){$(self.options.TopicsRoot).html("");
}if(self.options.Type!="matome"){$.each(_data.relativeTags,$.proxy(function(index,item){self._insert(item,sType);
},this));
}else{$.each(_data.tags,$.proxy(function(index,item){self._insert(item,sType);
},this));
}}return true;
},this),onError:$.proxy(function(){self._error("alert",CONST.ERROR.SERVER);
},this)});
},_delete:function(elem){elem.remove();
},_chk:function(sTopic){if(sTopic.length<1){return false;
}if(sTopic.length>25){this._error("alert",CONST.ERROR.TEXT_LIMIT);
return false;
}var _bChk=true;
var _aTags=$(CONST.LIST_ROOT).find(CONST.TOPIC_ELEM);
if(_aTags.length<1){return true;
}for(var i=0;
i<_aTags.length;
i++){if($(_aTags[i]).parent().data("item.data").name==sTopic){this._error("alert",CONST.ERROR.INPUT_LIMIT);
return false;
}}return true;
},_error:function(type,msg){if(type=="alert"){alert(msg);
}else{return confirm(msg);
}return false;
}};
})();
return $PROTOTYPE;
})("matome.mtmTopic"));
})(jQuery);
(function($){var template={item:'<li class="mdWordList01Li"><span class="MdWord01"><span class="mdWord01Del01"><input type="button" data-id="${similarId}" value="" class="mdWord01Del01Btn" title="削除"></span><span class="_topicWorld">${Topic}</span></span></li>'};
$.widget("matome.mtmTopicBoard",(function(){$PROTOTYPE=(function(){var CONST={EDIT:{HASH:"EDITABLE",FORM:"DIV.mdTopicHeading01Form",TOPIC_INPUT:"INPUT.mdTopicHeading01Ttl01Inputbox",DESCRIPT_TEXTAREA:"TEXTAREA.mdTopicHeading01Desc01Inputbox",SAVE_BTN:"INPUT.mdBtn01Complete02Btn",CANCLE_BTN:"A.mdBtn01Cancel01Btn",IMG:"P.mdTopicHeading01Thumb01Img IMG",SIMILAR:{ADD_BTN:"INPUT.mdBtn01Add04Btn",INPUT:"INPUT.mdTopicHeading01Form01Inputbox",ROOT:"UL.mdWordList01Ul.MdCF"}},BTN:{EDIT:"DIV.MdTopicHeading01 SPAN.MdBtn01Edit01"},VIEW:{FORM:"DIV.mdTopicHeading01View",TOPIC_ELEM:"H1.mdTopicHeading01Ttl01Ttl",DESCRIPT_ELEM:"P.mdTopicHeading01Desc01Txt",IMG:"DIV.mdTopicHeading01Thumb01 IMG"},TOPIC_PARENT:"DIV.mdTopicHeading01Ttl01",ERROR:{NGWORD_CHK:"登録できない文字が含まれています。 ",TEXT_LIMIT:"トピック名を1文字から25文字以内で入力してください。",DESCRIPT_LIMIT:"トピックの説明は１５０文字以内で入力してください。",COUNT_LIMIT:"表記ゆれは５個まで登録可能です。",DUPLE:"そのトピック名は登録できません。既に登録されているか、登録できない文字が含まれています。",DELETE:"削除しますか？",SAVE:"トピック情報の編集を保存しました。",TOPIC_DUPLE:"トピック名と同じ内容は登録できません。",SIMILAR_COUNT_LIMIT:"表記ゆれ内容を25文字以内で入力してください。",SERVER:"一時的な問題により、アクセスできません。しばらくしてからもう一度お試しください。",SESSION:"一定時間動作がなかったためセッションが切れました。再度ログインしてください。"}};
var API={SAVE:"/api/tag",SIMILAR:{SAVE:"/api/tag/similar",DELETE:"/api/tag/similar/"}};
return{options:{officalFlag:false,gnb:".MdHeadUtil01"},_create:function(){if($.cookie("NJID_AUT")!==null&&location.hash&&location.hash.substring(1)===CONST.EDIT.HASH){this._show();
location.hash="";
}this._attachEvent();
},_attachEvent:function(){var self=this;
$(CONST.BTN.EDIT).click($.proxy(function(e){e.preventDefault();
this._show();
return false;
},this));
$(CONST.EDIT.CANCLE_BTN).click($.proxy(function(e){e.preventDefault();
this._hide();
this._setContents();
return false;
},this));
$(CONST.EDIT.SAVE_BTN).click($.proxy(function(e){e.preventDefault();
this._save();
},this));
$(CONST.EDIT.SIMILAR.ADD_BTN).click($.proxy(function(e){e.preventDefault();
this._add(fnMatome.trim($(CONST.EDIT.SIMILAR.INPUT).njGetPlaceholderValue(),true));
},this));
$(CONST.EDIT.SIMILAR.INPUT).njPlaceholder();
$("A.mdBtn01Del02Btn").click($.proxy(function(e){e.preventDefault();
this._setImage({thumbUrl:"",originalUrl:""});
},this));
$("A.mdBtn01Help01Btn").click(function(e){e.preventDefault();
$("#_simillarHelp").modal($.extend({},{focus:false,overlayClose:true,escClose:false,autoPosition:false,opacity:0,overlayCss:{backgroundColor:"#000"},onShow:function(dialog){dialog.container.css({left:$("DD.mdTopicHeading01SimilarWord01Content").offset().left,top:$("DD.mdTopicHeading01SimilarWord01Content").offset().top,position:"absolute"});
$(window).resize(function(){dialog.container.css({left:$("DD.mdTopicHeading01SimilarWord01Content").offset().left,top:$("DD.mdTopicHeading01SimilarWord01Content").offset().top,position:"absolute"});
});
},onClose:function(){$(window).unbind("resize");
$.modal.close();
}}));
return false;
});
$("A._jUploadImage").njUploader({mode:"crop",prevUpload:null,onUploadComplete:function(e,res){$(this).njUploader("option","prevUpload",res);
},onUploadError:function(e,res){},submit:function(e,res){self._setImage({thumbUrl:res.url,originalUrl:res.url});
$.modal.close();
_bEdit=true;
}});
$("._jSearchImage").mtmSearch({modal:{opacity:50},onItemSelect:$.proxy(function(e,oData){var _oData=oData.data;
var sOriginalUrl=_oData.originalUrl;
if(sOriginalUrl&&$.isFunction(window.filterUrl)&&filterUrl(sOriginalUrl)){nj.common.message.alert("COMMON.COPYRIGHT_ERROR",{type:"画像"});
return;
}this._setImage(_oData);
this._searchQuery=$("._jSearchImage").mtmSearch("getSearchQuery");
$("._jSearchImage").mtmSearch("close");
$("._jSearchImage").show();
},this)}).click($.proxy(function($e){$e.preventDefault();
$.modal.close();
$e.preventDefault();
$("._jSearchImage").mtmSearch("open",{type:"image",itemAdditionLimit:1});
},this));
$.each($(CONST.EDIT.SIMILAR.ROOT).find("LI"),$.proxy(function(index,item){$(item).find("INPUT.mdWord01Del01Btn").click($.proxy(function(e){e.preventDefault();
this._delete($(e.currentTarget));
return false;
},this));
},this));
$(CONST.EDIT.DESCRIPT_TEXTAREA).njPlaceholder();
$(CONST.EDIT.TOPIC_INPUT).njPlaceholder();
$(".mdTopicHeading01FV01").shareButtons({template:{buttons:null,frame:'<div class="MdShareBtnList03"><ul class="mdShareBtnList03Ul"><li class="mdShareBtnList03Li"><a href="${twitter}" title="Twitterで共有する" class="MdShareBtn03 FnShareButton"><span class="mdShareBtn03Ico01Twitter">Twitter</span></a></li><li class="mdShareBtnList03Li"><a href="${facebookShare}" title="Facebookで共有する" class="MdShareBtn03 FnShareButton"><span class="mdShareBtn03Ico01Facebook">Facebook</span></a></li><li class="mdShareBtnList03Li"><a href="${hatebu}" title="はてなブックマークで共有する" class="MdShareBtn03 FnShareButton"><span class="mdShareBtn03Ico01Hatena">はてなブックマーク</span></a></li></ul><!--/MdShareBtnList03--></div>'},type:"03",sort:["twitter","facebook","hatebu"],likeButton:false,data:{text:document.title,url:location.href}});
this._searchQuery=decodeURIComponent($("a.mdImgCite03Url").attr("href").replace(/^.*q=(.*?)\&.*?$/g,"$1"));
this._loadImage();
},_loadImage:function(){var $img=$("div.mdTopicHeading01Thumb01 img");
if($img[0].readyState==="complete"||$img[0].readyState==="loaded"){var $target=$img.parent().find("span.MdImgCite03");
$target.removeClass("MdNonDisp");
}$img.bind("load",function(){var $this=$(this),$target=$this.parent().find("span.MdImgCite03"),isError=($this.attr("src").match("no_img")===null)?false:true;
if(isError){$target.addClass("MdNonDisp");
}else{$target.removeClass("MdNonDisp");
}return false;
});
return false;
},_clearInputBox:function(){$(CONST.EDIT.SIMILAR.INPUT).njSetPlaceholderValue("");
$(CONST.EDIT.SIMILAR.INPUT).blur();
},_setImage:function(oData){var el=$(CONST.EDIT.FORM).find(CONST.EDIT.IMG);
el.attr("src",oData.thumbUrl);
el.attr("data-img",oData.thumbUrl);
if(oData.thumbUrl!==""){$("A.mdBtn01Del02Btn").show();
$(CONST.EDIT.FORM).find(CONST.EDIT.IMG).show();
}else{$("A.mdBtn01Del02Btn").hide();
$(CONST.EDIT.FORM).find(CONST.EDIT.IMG).hide();
}},_add:function(sSimilarTopic){if((sSimilarTopic.length<1)||$(CONST.EDIT.SIMILAR.INPUT).njGetPlaceholderValue()===$(CONST.EDIT.SIMILAR.INPUT).attr("placeholder")){this._error("alert",CONST.ERROR.SIMILAR_COUNT_LIMIT);
return false;
}var sTopicTitle=fnMatome.trim($(CONST.EDIT.TOPIC_INPUT).njGetPlaceholderValue(),true);
if($(CONST.EDIT.SIMILAR.INPUT).attr("placeholder")===sSimilarTopic){return false;
}if(sTopicTitle===sSimilarTopic){this._error("alert",CONST.ERROR.TOPIC_DUPLE);
return false;
}if(sTopicTitle===sSimilarTopic){this._error("alert",CONST.ERROR.TOPIC_DUPLE);
return false;
}if($(CONST.EDIT.SIMILAR.ROOT).children().length>4){this._error("alert",CONST.ERROR.COUNT_LIMIT);
return false;
}var self=this;
var _data={name:sSimilarTopic,tagId:TAG_ID};
nj.matome.mtmAPIRequester.request({requester:"rest",method:"PUT",url:nj.replaceStr(API.SIMILAR.SAVE,{}),data:_data,onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._errorSimilarResponse(oResponse.error);
return false;
}else{var _elem=$($.tmpl(template.item,{similarId:oResponse.result.similarId}));
_elem.find("SPAN._topicWorld").text(oResponse.result.name).end().find("INPUT.mdWord01Del01Btn").click($.proxy(function(e){e.preventDefault();
self._delete($(e.currentTarget));
return false;
},self));
$(CONST.EDIT.SIMILAR.ROOT).append(_elem);
self._clearInputBox();
}},this),onError:$.proxy(function(){self._error("alert",CONST.ERROR.SERVER);
},this)});
},_delete:function(elem){var self=this;
if(this._error("confirm",CONST.ERROR.DELETE)){nj.matome.mtmAPIRequester.request({requester:"rest",method:"DELETE",url:nj.replaceStr(API.SIMILAR.DELETE+elem.attr("data-id"),{}),data:{},onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._errorSimilarResponse(oResponse.error);
return false;
}else{elem.parent().parent().parent().remove();
}},this),onError:$.proxy(function(oResponse){self._error("alert",CONST.ERROR.SERVER);
},this)});
}return false;
},_save:function(){var oValue=this._getInputValue();
var _sTopic=oValue.topic;
var _sDescript=oValue.descript;
var self=this;
if(!this.options.officalFlag){if(!this._chk(_sTopic,"topic")){return false;
}}else{_sTopic="";
}if(!this._chk(_sDescript,"descript")){return false;
}var _data={description:_sDescript,imageUrl:$(CONST.EDIT.FORM).find(CONST.EDIT.IMG).attr("data-img"),name:_sTopic,tagId:TAG_ID,imageKeyword:this._searchQuery};
nj.matome.mtmAPIRequester.request({requester:"rest",method:"POST",url:nj.replaceStr(API.SAVE,{}),data:_data,onSuccess:$.proxy(function(oResponse){if(oResponse.error){self._errorResponse(oResponse.error);
return false;
}else{window.location.reload();
}},this),onError:$.proxy(function(){self._error("alert",CONST.ERROR.SERVER);
},this)});
},_chk:function(sTopic,sType){if(sType=="topic"){if(sTopic.length<1){this._error("alert",CONST.ERROR.TEXT_LIMIT);
return false;
}}else{if(sTopic.length>150){this._error("alert",CONST.ERROR.DESCRIPT_LIMIT);
return false;
}}return true;
},_errorSimilarResponse:function(oData){if(oData.code==="100"){this._error("alert",oData.msg);
}else{if(oData.code==="90000"){this._error("alert",CONST.ERROR.SIMILAR_COUNT_LIMIT);
}else{if(oData.code==="16004"){this._error("alert",CONST.ERROR.NGWORD_CHK);
}else{if(oData.code==="14100"||oData.code==="16002"){this._error("alert",CONST.ERROR.DUPLE);
}else{if(oData.code==="401"){this._error("alert",CONST.ERROR.SESSION);
goLogin();
}else{this._error("alert",CONST.ERROR.SERVER);
}}}}}return false;
},_errorResponse:function(oData){if(oData.code==="100"){this._error("alert",oData.msg);
}else{if(oData.code==="90000"){this._error("alert",CONST.ERROR.TEXT_LIMIT);
}else{if(oData.code==="16004"){this._error("alert",CONST.ERROR.NGWORD_CHK);
}else{if(oData.code==="14100"||oData.code==="16002"){this._error("alert",CONST.ERROR.DUPLE);
}else{if(oData.code==="401"){this._error("alert",CONST.ERROR.SESSION);
goLogin();
}else{this._error("alert",CONST.ERROR.SERVER);
}}}}}return false;
},_getInputValue:function(){var elTopic=$(CONST.EDIT.TOPIC_INPUT);
var elDescript=$(CONST.EDIT.DESCRIPT_TEXTAREA);
var sTopic=fnMatome.trim(elTopic.njGetPlaceholderValue(),true);
var sDescript=fnMatome.trim(elDescript.njGetPlaceholderValue(),true);
if(sTopic===elTopic.attr("placeholder")){sTopic="";
}if(sDescript===elDescript.attr("placeholder")){sDescript="";
}return{topic:sTopic,descript:sDescript};
},_error:function(sType,sMsg){if(sType=="alert"){alert(sMsg);
}else{return confirm(sMsg);
}return false;
},_show:function(){var self=this;
if($.cookie("NJID_AUT")==null){var fCallback=function(){if(location.hash!==CONST.EDIT.HASH){location.hash=CONST.EDIT.HASH;
setTimeout(function(){location.reload(true);
},800);
}};
var loginOptions={loginDomain:g_loginDomain,loginApi:g_loginApi,proxyUrl:g_proxyUrl,rsaKeysApi:g_rsaKeysApi,success:fCallback};
window.g_callback=fCallback;
$(CONST.BTN.EDIT).njLogin(loginOptions);
$(CONST.BTN.EDIT).njLogin("view");
return false;
}this._setContents();
$(CONST.VIEW.FORM).hide();
$(CONST.EDIT.FORM).show();
var el=$(CONST.EDIT.DESCRIPT_TEXTAREA);
var s=el.njGetPlaceholderValue();
el.njSetPlaceholderValue(s).blur();
return false;
},_hide:function(){$(CONST.EDIT.FORM).hide();
$(CONST.VIEW.FORM).show();
},_setContents:function(){if(this.options.officalFlag){$($(CONST.VIEW.FORM).find(CONST.TOPIC_PARENT).clone()).replaceAll($(CONST.EDIT.FORM).find(CONST.TOPIC_PARENT));
}else{$(CONST.EDIT.TOPIC_INPUT).njSetPlaceholderValue($(CONST.VIEW.TOPIC_ELEM).text());
}this._clearInputBox();
$(CONST.EDIT.DESCRIPT_TEXTAREA).njSetPlaceholderValue($(CONST.VIEW.DESCRIPT_ELEM).text());
this._setImage({thumbUrl:$(CONST.VIEW.FORM).find(CONST.VIEW.IMG).attr("data-img"),originalUrl:$(CONST.VIEW.FORM).find(CONST.VIEW.IMG).attr("data-img")});
}};
})();
return $PROTOTYPE;
})("matome.mtmTopicBoard"));
})(jQuery);
(function($){$.widget("matome.mtmSearch",(function(WIDGET_NAME){var CONST={CONTENT_TYPE:{IMAGE:{TITLE:"画像",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"NAVER",value:"naver"},{name:"Google",value:"google"},{name:"Flickr",value:"flickr"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchImage",CONTENT_DETAIL_WIDGET_NAME:"mtmSearchImageDetail",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_image"},VIDEO:{TITLE:"動画",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"Google",value:"google"},{name:"YouTube",value:"youtube"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchVideo",CONTENT_DETAIL_WIDGET_NAME:"mtmSearchVideoDetail",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_video"},LINK:{TITLE:"リンク",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"NAVER",value:"naver"},{name:"Google",value:"google"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchLink",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_link"},TWITTER:{TITLE:"ツイート",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"RADIO",TARGET_SELECTOR_ITEMS:[{name:"ツイート",value:"tweet"},{name:"ユーザー名",value:"userName"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchTwitter",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_twitter"}},TARGET_SELECTOR_STYLE:{NONE:"NONE",TAB:"TAB",RADIO:"RADIO"},TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX:WIDGET_NAME+".targetSelectorRadio.",TARGET_SELECTOR_RADIO_INPUT_NAME:WIDGET_NAME+".targetSelectorRadio",VIEW_TYPE:{LIST:0,DETAIL:1},N_STAT_CODE:{ATTRIBUTE:"data-na"}};
var EVENT={ON_OPEN:"onOpen",ON_ITEM_SELECT:"onItemSelect",ON_CLOSE:"onClose"};
var SELECTOR={TYPE_TITLE:"SPAN._jTypeTitle",CATEGORY_SELECTOR:"DIV.MdSelectBox01",QUERY_INPUT:"INPUT.mdSearch01Input01",SEARCH_BUTTON:"INPUT.mdBtn01Search02Btn",BODY:"DIV.mdLayer02Body",TARGET_SELECTOR_TAB:"UL.MdTabMenu01",TARGET_SELECTOR_TAB_SELECTED:"SPAN",TARGET_SELECTOR_TAB_SELECTABLE:"A",TARGET_SELECTOR_RADIO:"DIV.MdTabMenu02",TARGET_SELECTOR_RADIO_SELECTABLE:"INPUT",HEAD_AREA:"DIV.mdLayer02BodyHeadTxtR01",POWERED_BY:"SPAN.mdLayer02PoweredBy01",ITEM_COUNTER_SELECTED:"SPAN.MdCount01",ITEM_COUNTER_SELECTED_TEXT:"SPAN.mdCount01Inner",ITEM_COUNTER_TOTAL:"SPAN._jItemTotalCounter",ITEM_COUNTER_TOTAL_VALUE:"SPAN._jItemTotal",CONTENTS_AREA:"DIV.mdLayer02BodyCont",MORE_BUTTON:"P.mdLayer01BtnMore",MORE_BUTTON_DEFAULT:"A.mdBtn01More01Btn",MORE_BUTTON_PROGRESS:"SPAN.mdBtn01More01Loading",NO_RESULT_TEXT:"P.mdSearchLayer02Txt01",ERROR_TEXT:"P.mdSearchLayer02Txt02",BACK_TO_LIST_BUTTON:"P.mdLayer02BodyHeadTxtL01 > A",ALERT_ITEM_DUPLICATED_CLOSE_BUTTON:"A.mdBtn01Close02Btn"};
var CLASS={CLOSE_BUTTON:"mdBtn01Close01Btn",ITEM_COUNTER_SELECTED_EXIST:"mdCount01OverSize"};
var TEXT={QUERY_INPUT_PLACEHOLDER:"${typeTitle}を検索するキーワードを入力",NO_RESULT_TEXT_DEFAULT_TARGET1:"検索ワード",NO_RESULT_TEXT_DEFAULT_TARGET2:"キーワード",ALERT_EMPTY_QUERY:"検索するキーワードを入力してください。",ALERT_ITEM_ADDITION_LIMIT:"まとめ作成前に追加できる${type}数を超えました。\nこれ以上の${type}追加は、まとめ作成後に行ってください。",ALERT_ERROR:"一時的な問題により実行できませんでした。\nしばらくしてから再度お試しください。"};
var TEMPLATE={SEARCH_LAYER:['<div class="MdLayer02" style="width:912px;" data-na="${nStatCode}">','<div class="mdLayer02Wrap">','<div class="mdLayer02Head">','<fieldset class="MdSearch01 MdCF">',"<legend>検索</legend>",'<div class="mdSearch01H1"><span class="MdFontB"><span class="_jTypeTitle">${typeTitle}</span>を探す</span></div>','<div class="MdSelectBox01">','<div class="mdSelectBox01Search01 njSelectBox-labelContainer">','<span class="mdSelectBox01Search01Label njSelectBox-label">すべて</span>','<span class="mdSelectBox01Search01Ico njSelectBox-opener"></span>',"</div>",'<ul class="mdSelectBox01Option01 njSelectBox-optionContainer" style="display:none;">','<li njselectbox-value="Books">本</li>','<li njselectbox-value="ForeignBooks">洋書</li>','<li njselectbox-value="DVD">DVD</li>','<li njselectbox-value="Music">ミュージック</li>','<li njselectbox-value="Electronics">パソコン・周辺機器</li>','<li njselectbox-value="MusicalInstruments">楽器</li>','<li njselectbox-value="VideoGames">TVゲーム</li>','<li njselectbox-value="Software">PCソフト</li>','<li njselectbox-value="OfficeProducts">文房具・オフィス用品</li>','<li njselectbox-value="Kitchen">ホーム&キッチン</li>','<li njselectbox-value="Grocery">食品&飲料</li>','<li njselectbox-value="HealthPersonalCare">ヘルス&ビューティー</li>','<li njselectbox-value="Beauty">コスメ</li>','<li njselectbox-value="Baby">ベビー&マタニティ</li>','<li njselectbox-value="Toys">おもちゃ</li>','<li njselectbox-value="Apparel">服＆ファッション小物</li>','<li njselectbox-value="Shoes">シューズ＆バッグ</li>','<li njselectbox-value="Jewelry">ジュエリー</li>','<li njselectbox-value="Watches">時計</li>','<li njselectbox-value="SportingGoods">スポーツ&アウトドア</li>','<li njselectbox-value="Automotive">カー＆バイク用品</li>','<li njselectbox-value="Hobbies">ホビー</li>','<li njselectbox-value="HomeImprovement">DIY・工具</li>',"</ul>","<!--/MdSelectBox01--></div>",'<div class="mdSearch01Form01"><input type="text" value="" class="mdSearch01Input01" placeholder="$cursor$を検索するキーワードを入力"></div>','<p class="mdSearch01BtnSearch"><span class="MdBtn01Search02"><input type="button" value="検索" class="mdBtn01Search02Btn" data-na="NC:searchKeyword"></span></p>',"</fieldset>","<!--/mdLayer02Head--></div>",'<div class="mdLayer02Body" style="display:none">','<div class="mdLayer02BodyHead">','<ul class="MdTabMenu01 MdCF" style="display:none">',"</ul>",'<div class="MdTabMenu02" style="display:none">',"</div>",'<div class="mdLayer02BodyHeadTxtR01">追加した<span class="_jTypeTitle">${typeTitle}</span> ','<span class="MdCount01"><span class="mdCount01Inner">0</span></span> 件','<span class="_jItemTotalCounter" style="display:none">/<span class="_jItemTotal">0</span>件</span>',"</div>","<!--/mdLayer02BodyHead--></div>",'<div class="mdLayer02BodyCont mdLayer02Overflow">','<p class="mdLayer01BtnMore" style="display:none;"><span class="MdBtn01More01">','<a class="mdBtn01More01Btn MdLink04" href="#" data-na="NC:viewMore">もっと見る</a>','<span class="mdBtn01More01Loading" style="display:none">読み込み中</span>',"</span></p>",'<p class="mdSearchLayer02Txt01" style="display:none;"></p>','<p class="mdSearchLayer02Txt02" style="margin-top: 288px; display:none;"><span class="mdSearchLayer02Txt02Ico"></span><span class="mdSearchLayer02Txt02Txt">一時的な問題により実行できませんでした。<br>しばらくしてから再度お試しください。</span></p>',"<!--/mdLayer02BodyCont--></div>","<!--/mdLayer02Body--></div>",'<div class="mdLayer02Body" style="display:none">','<div class="mdLayer02BodyHead">','<p class="mdLayer02BodyHeadTxtL01"><a href="#" data-na="NC:backToList">リストへ戻る</a></p>','<div class="mdLayer02BodyHeadTxtR01">追加した<span class="_jTypeTitle">${typeTitle}</span> ','<span class="MdCount01"><span class="mdCount01Inner">0</span></span> 件',"</div>","<!--/mdLayer02BodyHead--></div>",'<div class="mdLayer02BodyCont">','<p class="mdSearchView01BtnMTM">','<a href="#" class="MdBtn02MTM01" data-na="NC:addItem"><span class="mdBtn02MTM01Ico"></span><span class="mdBtn02MTM01Txt">追加する</span></a>','<span class="MdBtn02MTM02" style="display:none;"><span class="mdBtn02MTM02Ico"></span><span class="mdBtn02MTM02Txt">追加済み</span></span>',"</p>",'<div class="_jContentDetailView">','<div class="_jContentContainer" />','<p class="mdSearchView01Pagination">','<a style="height: 700px;" href="#" class="mdSearchView01PaginationPrev" title="前の画像へ" data-na="NC:prevItem"><span>前の画像へ</span></a>','<a style="height: 700px;" href="#" class="mdSearchView01PaginationNext" title="次の画像へ" data-na="NC:nextItem"><span>次の画像へ</span></a>',"</p>","<!--/MdSearchView01--></div>","<!--/mdLayer02BodyCont--></div>","<!--/mdLayer02Body--></div>","<!--/mdLayer02Wrap--></div>",'<p class="mdLayer02BtnClose"><span class="MdBtn01Close01"><a href="#" class="mdBtn01Close01Btn" title="レイヤーを閉じる" data-na="NC:closeSearchLayer">レイヤーを閉じる</a></span></p>',"<!--/MdLayer02--></div>"].join(""),TARGET_SELECTOR_TAB:$.template(null,["<li>",'<span class="mdTabMenu01On" style="display:none">${name}</span>','<a href="#" value="${value}" class="mdTabMenu01Off" data-na="NC:${value}tab">${name}</a>',"</li>"].join("")),TARGET_SELECTOR_RADIO:$.template(null,['<label for="',CONST.TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX,'${value}" class="mdTabMenu02Chk">','<input type="radio" id="',CONST.TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX,'${value}" name="',CONST.TARGET_SELECTOR_RADIO_INPUT_NAME,'" value="${value}" data-na="NC:searchKeywordAt_${value}">${name}',"</label>"].join("")),ALERT_SEARCH_PROGRESS:['<div style="left: 700px; top: 17px;" class="MdLayer03">','<div class="mdLayer03Body">','<p class="MdLayer03Txt01"><span class="MdLayer03Loading01"></span><span class="MdFontB">検索中です</span></p>',"<!--/mdLayer03Body--></div>","<!--/MdLayer03--></div>"].join(""),ALERT_ITEM_DUPLICATED:['<div style="left: 415px; top: 17px;" class="MdLayer03">','<div class="mdLayer03Body">','<p class="MdLayer03Txt01"><span class="MdFontB">追加済みの<span class="_jTypeTitle">${typeTitle}</span>です。</span></p>','<p class="mdLayer03BtnClose"><span class="MdBtn01Close02"><a title="閉じる" class="mdBtn01Close02Btn" href="#" data-na="NC:"closeAlertDuplicated">閉じる</a></span></p>',"<!--/mdLayer03Body--></div>","<!--/MdLayer03--></div>"].join(""),NO_RESULT_TEXT:$.template(null,["${target1}",'<span class="MdColor07">「${query}」</span>',"{{if customMessage}}","${customMessage}","{{else}}","に一致する${type}は見つかりませんでした。<br>","${target2}が正しく入力されているかを確認してください。","{{/if}}"].join("")),ITEM_LIST:{IMAGE:'<ul class="MdSearchList01 MdCF">',VIDEO:'<ul class="MdSearchList02 MdCF">',LINK:'<ul class="MdSearchList03">',TWITTER:'<ul class="MdSearchList03">'},POWERED_BY:{google:$.template(null,['<span class="mdLayer02PoweredBy01">','<a href="http://www.google.com/" target="_blank" data-na="NL:url_google"><img src="${STATIC_SERVER}/matome_ver4/img/md/img_mdLayer02PoweredBy01Google.png" alt="Powered by Google" class="mdLayer02PoweredBy01Google"></a>','<span class="MdSeparator01P05">|</span>',"</span>"].join("")),youtube:$.template(null,['<span class="mdLayer02PoweredBy01">','<a href="http://www.youtube.com/" target="_blank" data-na="NL:url_youTube"><img src="${STATIC_SERVER}/matome_ver4/img/md/img_mdLayer02PoweredBy01YouTube.png" alt="Powered by YouTube" class="mdLayer02PoweredBy01YouTube"></a>','<span class="MdSeparator01P05">|</span>',"</span>"].join("")),flickr:$.template(null,['<span class="mdLayer02PoweredBy01">',"This product uses the Flickr API but is not endorsed or certified by Flickr.",'<span class="MdSeparator01P05">|</span>',"</span>"].join(""))}};
return{options:{animation:false,alertDisplayDuration:2000,marginTop:10,minHeight:580,maxHeight:1400,modal:{opacity:50,overlayCss:{backgroundColor:"#000"},focus:true},onOpen:function($e,$oData){},onItemSelect:function($e,$oData){},onClose:function($e,$oData){}},open:function($oOptions){if(!CONST.CONTENT_TYPE[$oOptions.type&&$oOptions.type.toUpperCase()]){return false;
}(this._jqSearchLayer||(this._jqSearchLayer=$(TEMPLATE.SEARCH_LAYER))).modal($.extend({},this.options.modal,{closeClass:CLASS.CLOSE_BUTTON,position:[this.options.marginTop,null],onOpen:this.options.animation?$.proxy(function($oDialog){$oDialog.overlay.fadeIn("fast",$.proxy(function(){$oDialog.container.show().css("top",-100).animate({top:this.options.marginTop+"px"},100);
$oDialog.data.show(1,$.proxy(function(){this._initSearchLayer($oOptions,$oDialog);
},this));
},this));
},this):undefined,onShow:!this.options.animation?$.proxy(function($oDialog){this._initSearchLayer($oOptions,$oDialog);
$.stopScrollBody();
},this):undefined,onClose:$.proxy(function($oDialog){this._clearSearchLayer();
this.options.animation?$oDialog.container.animate({top:-100+"px"},100,null,$.proxy(function(){$oDialog.data.hide();
$oDialog.overlay.fadeOut("fast",$.proxy(function(){$.modal.close();
},this));
})):$.modal.close();
$.stopScrollBody.release();
},this)}));
this._jqSearchLayer.njLayerSupport();
},close:function(){$.modal.close();
},checkItem:function($oSelectedItem,$bIsDuplicated){this._addedItems($oSelectedItem.key,$oSelectedItem.data);
this._excuteContentWidget("checkItem",$oSelectedItem,$bIsDuplicated);
if(!$bIsDuplicated){this._itemCounterSelected(this._itemCounterSelected()+1);
(this._itemAdditionAvailableLength()!=-1)&&this._itemAdditionAvailableLength(this._itemAdditionAvailableLength()-1);
}$oSelectedItem.triggeredByContentDetail&&this._excuteContentDetailWidget("check",$bIsDuplicated);
},showItemDuplicated:function($oSelectedItem){if(this._nAlertDisplayTimeout||this._jqAlertItemDuplicated.parent().length){clearTimeout(this._nAlertDisplayTimeout);
this._nAlertDisplayTimeout=null;
}this._appendAlertWindowToCenter(this._jqAlertItemDuplicated.show());
$(SELECTOR.TYPE_TITLE,this._jqAlertItemDuplicated).text(CONST.CONTENT_TYPE[this._sType].TITLE);
$(SELECTOR.ALERT_ITEM_DUPLICATED_CLOSE_BUTTON,this._jqAlertItemDuplicated).click($.proxy(function($e){$e.preventDefault();
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
},this));
this._nAlertDisplayTimeout=setTimeout($.proxy(function(){this._nAlertDisplayInterval=null;
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
},this),this.options.alertDisplayDuration);
this.checkItem($oSelectedItem,true);
},showError:function($oSelectedItem,$sMessages){alert($sMessages||TEXT.ALERT_ERROR);
},_create:function(){this._jqWindow=$(window);
this._jqDocument=$(document);
},_init:function(){},_initElementReferences:function(){this._jqCategorySelector=$(SELECTOR.CATEGORY_SELECTOR,this._jqSearchLayer);
this._jqQueryInput=$(SELECTOR.QUERY_INPUT,this._jqSearchLayer);
this._jqSearchButton=$(SELECTOR.SEARCH_BUTTON,this._jqSearchLayer);
this._jqBody=$(SELECTOR.BODY,this._jqSearchLayer);
this._jqTargetSelectorTab=$(SELECTOR.TARGET_SELECTOR_TAB,this._jqSearchLayer);
this._jqTargetSelectorRadio=$(SELECTOR.TARGET_SELECTOR_RADIO,this._jqSearchLayer);
this._jqHeadArea=$(SELECTOR.HEAD_AREA,this._jqSearchLayer);
this._jqItemCounterSelected=$(SELECTOR.ITEM_COUNTER_SELECTED,this._jqSearchLayer);
this._jqItemCounterTotal=$(SELECTOR.ITEM_COUNTER_TOTAL,this._jqSearchLayer);
this._jqContentsArea=$(SELECTOR.CONTENTS_AREA,this._jqSearchLayer);
this._jqMoreButton=$(SELECTOR.MORE_BUTTON,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqMoreButtonDefault=$(SELECTOR.MORE_BUTTON_DEFAULT,this._jqMoreButton);
this._jqMoreButtonProgress=$(SELECTOR.MORE_BUTTON_PROGRESS,this._jqMoreButton);
this._jqNoResultText=$(SELECTOR.NO_RESULT_TEXT,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqErrorText=$(SELECTOR.ERROR_TEXT,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqBackToListButton=$(SELECTOR.BACK_TO_LIST_BUTTON,this._jqBody[CONST.VIEW_TYPE.DETAIL]);
this._jqDetailView=$(this._jqContentsArea[CONST.VIEW_TYPE.DETAIL]);
this._jqAlertSearchProgress=$(TEMPLATE.ALERT_SEARCH_PROGRESS);
this._jqAlertItemDuplicated=$(TEMPLATE.ALERT_ITEM_DUPLICATED);
this._bSearchLayerHasInitialized=true;
},_initSearchLayer:function($oOptions,$oDialog){$oOptions=$.extend(true,{type:"",targetSelectorStyle:"",targetSelectorItems:undefined,categorySelectorVisible:undefined,itemsTotalVisible:undefined,opener:null,addedItems:[],itemAdditionLimit:undefined},$oOptions);
!this._bSearchLayerHasInitialized&&this._initElementReferences();
this._oOpener=$oOptions.opener;
this._oSearchLayerDialog=$oDialog;
this._setType($oOptions.type);
this._setTargetSelectorStyle($oOptions.targetSelectorStyle)||this._setTargetSelectorStyle(CONST.CONTENT_TYPE[this._sType].TARGET_SELECTOR_STYLE);
this._setTargetSelectorItems(($oOptions.targetSelectorItems!=undefined)?$oOptions.targetSelectorItems:CONST.CONTENT_TYPE[this._sType].TARGET_SELECTOR_ITEMS);
this._itemCounterSelected(0);
this._setAddedItems(nj.matome.mtmSearchItemParser.getAddedItemsObject(this._sType,$oOptions.addedItems));
this._nItemAdditionLimit=($oOptions.itemAdditionLimit!=undefined)?$oOptions.itemAdditionLimit:(CONST.CONTENT_TYPE[this._sType].ITEM_ADDITION_LIMIT||-1);
this._itemAdditionAvailableLength((this._nItemAdditionLimit>-1)&&(this._nItemAdditionLimit-this._getAddedItemsLength(this._addedItems())));
(($oOptions.categorySelectorVisible!=undefined)?$oOptions.categorySelectorVisible:CONST.CONTENT_TYPE[this._sType].CATEGORY_SELECTOR_VISIBLE)?this._setCategorySelector(true):this._setCategorySelector(false);
(($oOptions.itemsTotalVisible!=undefined)?$oOptions.itemsTotalVisible:CONST.CONTENT_TYPE[this._sType].ITEMS_TOTAL_VISIBLE)?this._itemCounterTotal(this._itemAdditionAvailableLength()):this._itemCounterTotal(false);
this._jqMoreButtonDefault.click($.proxy(function($e){$e.preventDefault();
this._jqMoreButtonDefault.blur();
this._excuteContentWidget("searchMore");
},this));
this._jqBackToListButton.click($.proxy(function($e){$e.preventDefault();
this._viewType(CONST.VIEW_TYPE.LIST);
},this));
this._jqSearchButton.click($.proxy(function($e){this._jqQueryInput.triggerHandler("focus.njPlaceholder");
if(this._sQuery=this._verifyQuery(this._jqQueryInput.njGetPlaceholderValue())){this._search();
}},this));
this._jqQueryInput.keydown($.proxy(function($e){if($e.keyCode==13){this._jqSearchButton.click();
}},this));
this._jqQueryInput.focus($.proxy(function($e){setTimeout($.proxy(function(){this._jqQueryInput.njGetPlaceholderValue()&&this._jqQueryInput.select();
},this),1);
},this)).val(this._sQuery="").focus();
this._jqSearchLayer.attr(CONST.N_STAT_CODE.ATTRIBUTE,CONST.CONTENT_TYPE[this._sType].N_STAT_CODE);
this._jqWindow.resize($.proxy(this._checkLayerScrollable,this)).scroll($.proxy(this._updateLayerPosition,this));
this._checkLayerScrollable();
this._trigger(EVENT.ON_OPEN,null);
},_checkLayerScrollable:function($e){var nWindowHeight=parseInt(this._jqWindow.height(),10);
var nSearchLayerHeight=parseInt(this._jqSearchLayer.outerHeight(),10);
this._bIsLayerVerticalScrollable=nWindowHeight<nSearchLayerHeight+this.options.marginTop;
var nWindowWidth=parseInt(this._jqWindow.width(),10);
var nSearchLayerWidth=parseInt(this._jqSearchLayer.outerWidth(),10);
this._bIsLayerHorizontalScrollable=nWindowWidth<nSearchLayerWidth;
(this._bIsLayerVerticalScrollable||this._bIsLayerHorizontalScrollable)&&this._updateLayerPosition();
},_updateLayerPosition:function($e){var jqModalDialog=this._oSearchLayerDialog.container;
if(this._bIsLayerVerticalScrollable){var nWindowHeight=parseInt(this._jqWindow.height(),10);
var nDocumentHeight=parseInt(this._jqDocument.height(),10);
var nAvailableScrollHeight=nDocumentHeight-nWindowHeight;
if(Boolean(nAvailableScrollHeight)){var nDocumentScrollTop=parseInt(this._jqDocument.scrollTop(),10);
var nScrollTopRate=nDocumentScrollTop/nAvailableScrollHeight*100;
var nLayerHeight=parseInt(this._jqSearchLayer.outerHeight(),10)+this.options.marginTop;
var nLayerScrollHeight=nLayerHeight-nWindowHeight;
var nLayerTop=parseInt(nScrollTopRate*nLayerScrollHeight/100,10);
jqModalDialog.css("top",Math.min(-nLayerTop,0)+this.options.marginTop);
}}if(this._bIsLayerHorizontalScrollable){var nWindowWidth=parseInt(this._jqWindow.width(),10);
var nDocumentWidth=parseInt(this._jqDocument.width(),10);
var nAvailableScrollWidth=nDocumentWidth-nWindowWidth;
if(Boolean(nAvailableScrollWidth)){var nDocumentScrollLeft=parseInt(this._jqDocument.scrollLeft(),10);
var nScrollLeftRate=nDocumentScrollLeft/nAvailableScrollWidth*100;
var nLayerWidth=parseInt(this._jqSearchLayer.outerWidth(),10);
var nLayerScrollWidth=nLayerWidth-nWindowWidth;
var nLayerLeft=parseInt(nScrollLeftRate*nLayerScrollWidth/100,10);
jqModalDialog.css("left",Math.min(-nLayerLeft,0));
}}},_clearSearchLayer:function(){if(!this._bSearchLayerHasInitialized){return;
}var oAddedItems=$.extend(true,{},this._addedItems());
var nAddedLength=this._getAddedItemsLength(oAddedItems);
this._oOpener=null;
this._sContext=null;
this._oSearchLayerDialog=null;
this._itemCounterTotal(false);
this._setAddedItems(null);
this._clearContentsArea();
this._setTargetSelectorStyle(CONST.TARGET_SELECTOR_STYLE.NONE);
this._setTargetSelectorItems();
this._poweredByContextView(null);
this._body(false);
this._bIsLayerVerticalScrollable=this._bIsLayerHorizontalScrollable=false;
this._jqWindow.unbind("resize",this._checkLayerScrollable).unbind("scroll",this._updateLayerPosition);
this._trigger(EVENT.ON_CLOSE,null,{addedItems:oAddedItems,addedLength:nAddedLength});
},_initContentList:function(){this._clearContentsArea();
this._jqContentList=this._getContentWidgetName()&&$(TEMPLATE.ITEM_LIST[this._sType])[this._getContentWidgetName()]({itemsPerPage:CONST.CONTENT_TYPE[this._sType].CONTENT_ITEMS_PER_PAGE,addedItems:this._addedItems(),onSearchProgress:$.proxy(function($e,$oData){$oData.page?this._changeMoreButtonToProgress():this._appendAlertWindowToCenter(this._jqAlertSearchProgress);
},this),onSearchComplete:$.proxy(function($e,$oData){$oData.page?this._changeMoreButtonToDefault():this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
},this),onSearchResultData:$.proxy(function($e,$oData){this._searchedDataList($oData.dataList);
},this),onSearchResultOverflow:$.proxy(function(){this._hasResultMore(true);
},this),onSearchResultEnd:$.proxy(function(){this._hasResultMore(false);
},this),onSearchNoResult:$.proxy(function($e,$oData){$oData.page?this._hasResultMore(false):(($oData.target1&&$oData.target2)?this._noResultText($oData.query,$oData.target1,$oData.target2,$oData.customMessage):this._noResultText($oData.query));
},this),onSearchError:$.proxy(function($e,$oData){if($oData.page){this._changeMoreButtonToDefault();
alert(TEXT.ALERT_ERROR);
}else{this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
this._errorText(true);
}},this),onItemSelect:$.proxy(function($e,$oData){if(this._itemAdditionAvailableLength()!=-1&&this._itemAdditionAvailableLength()<=0){alert(nj.replaceStr(this._excuteContentWidget("getAdditionLimitMessage")||TEXT.ALERT_ITEM_ADDITION_LIMIT,{type:CONST.CONTENT_TYPE[this._sType].TITLE,itemAdditionLimit:this._nItemAdditionLimit}));
return;
}this._trigger(EVENT.ON_ITEM_SELECT,null,$.extend({},$oData,{opener:this._oOpener,type:this._sType,triggeredByContentDetail:$e.originalEvent?false:true}));
},this),onItemDetailView:$.proxy(function($e,$oData){var oContentDetailData=this._getContentDetailData($oData.index);
if(oContentDetailData){this._viewType(CONST.VIEW_TYPE.DETAIL);
this._excuteContentDetailWidget("show",oContentDetailData);
}},this)}).prependTo(this._jqContentsArea[CONST.VIEW_TYPE.LIST]);
this._getContentDetailWidgetName()&&this._jqDetailView[this._getContentDetailWidgetName()]({onItemSelect:$.proxy(function($e,$oData){this._excuteContentWidget("selectItem",$oData.index);
},this),onPrev:$.proxy(function($e,$oData){var oContentDetailData=this._getContentDetailData($oData.index-1);
oContentDetailData&&this._excuteContentDetailWidget("show",oContentDetailData);
},this),onNext:$.proxy(function($e,$oData){var nNextIndex=$oData.index+1;
var oContentDetailData=this._getContentDetailData(nNextIndex);
oContentDetailData&&this._excuteContentDetailWidget("show",oContentDetailData);
if(nNextIndex>=this._searchedDataList().length){this._excuteContentWidget("searchMore",$.proxy(function($e){this._excuteContentDetailWidget("show",this._getContentDetailData(nNextIndex));
},this));
}},this)});
this._excuteContentWidget("search",this._sQuery,this._sContext);
},_removeContentList:function(){if(!this._jqContentList){return;
}this._excuteContentWidget("destroy");
this._jqContentsArea.scrollTop(0);
this._jqContentList.remove();
this._jqContentList=null;
},_clearContentsArea:function(){this._removeContentList();
this._hasResultMore(false);
this._noResultText(null);
this._errorText(null);
this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
this._searchedDataList(null);
},_getContentWidgetName:function(){return this._sType?CONST.CONTENT_TYPE[this._sType].CONTENT_WIDGET_NAME:undefined;
},_getContentDetailWidgetName:function(){return this._sType?CONST.CONTENT_TYPE[this._sType].CONTENT_DETAIL_WIDGET_NAME:undefined;
},_excuteContentWidget:function(){if(!this._jqContentList){return;
}var data=this._jqContentList.data("matome-"+this._getContentWidgetName());
if(data&&data[arguments[0]]){return this._jqContentList[this._getContentWidgetName()].apply(this._jqContentList,arguments);
}},_excuteContentDetailWidget:function(){var fnWidgetFunction=this._jqDetailView[this._getContentDetailWidgetName()];
return fnWidgetFunction&&fnWidgetFunction.apply(this._jqDetailView,arguments);
},_verifyQuery:function($sInputtedValue){var sQuery=fnMatome.trim($sInputtedValue,true)||"";
if(!sQuery){alert(TEXT.ALERT_EMPTY_QUERY);
this._jqQueryInput.focus();
}return sQuery;
},_search:function(){if(!this._sQuery){return;
}if(!this._body()){this._body(true,this._initContentList);
}else{this._viewType(CONST.VIEW_TYPE.LIST);
this._initContentList();
}},_searchedDataList:function($aSearchedDataList){if(!arguments.length){return this._aSearchedDataList;
}else{if($aSearchedDataList&&$.isArray($aSearchedDataList)){return this._aSearchedDataList=(this._aSearchedDataList&&$.merge(this._aSearchedDataList,$aSearchedDataList))||$aSearchedDataList;
}else{return this._aSearchedDataList=null;
}}},_setAddedItems:function($oAddedItems){if(!$oAddedItems){return this._addedItems(null);
}for(var k in $oAddedItems){this._addedItems(k,$oAddedItems[k]);
}return this._addedItems();
},_addedItems:function($sKey,$oValue){if(!arguments.length){return this._oAddedItems;
}else{if($sKey){if($oValue){this._oAddedItems=this._oAddedItems||{};
return this._oAddedItems[$sKey]=$oValue;
}else{return this._oAddedItems?this._oAddedItems[$sKey]:undefined;
}}else{return this._oAddedItems=null;
}}},_getAddedItemsLength:function($oAddedItems){var nCount=0;
for(var k in $oAddedItems){nCount++;
}return nCount;
},_getContentDetailData:function($nIndex){var oData=this._searchedDataList()[$nIndex];
if(!oData){return null;
}var nListLength=this._searchedDataList().length;
var bHasResultMore=this._hasResultMore();
var sContentKey=this._excuteContentWidget("getItemByIndex",$nIndex).data("key");
var bIsAdded=(sContentKey&&this._addedItems(sContentKey))?true:false;
return{index:$nIndex,data:oData,listLength:nListLength,hasResultMore:bHasResultMore,isAdded:bIsAdded};
},_setType:function($sType){var sType=$sType&&$sType.toUpperCase();
if(!CONST.CONTENT_TYPE[sType]){return false;
}if(this._jqSearchLayer){var typeTitle=CONST.CONTENT_TYPE[sType].TITLE;
$(SELECTOR.TYPE_TITLE,this._jqSearchLayer).text(typeTitle);
this._jqQueryInput.attr("placeholder",nj.replaceStr(TEXT.QUERY_INPUT_PLACEHOLDER,{typeTitle:typeTitle})).njPlaceholder();
}return this._sType=sType;
},_body:function($bOpen,$fnOnShow){if(!arguments.length){return this._bBodyOpened;
}else{if($bOpen){var fnOpenBody=$.proxy(function(){if(!this._oSearchLayerDialog){return;
}this._jqWindow.resize($.proxy(this._resizeContentArea,this));
this._resizeContentArea();
this._checkLayerScrollable();
this._bBodyOpened=true;
this._nResizeOnOpenTimeout&&clearTimeout(this._nResizeOnOpenTimeout);
this._nResizeOnOpenTimeout=setTimeout($.proxy(function(){if(!this._nResizeOnOpenTimeout){return;
}this._resizeContentArea();
this._checkLayerScrollable();
this._nResizeOnOpenTimeout=null;
},this),100);
$fnOnShow.call(this);
},this);
if(this.options.animation){$(this._jqBody[CONST.VIEW_TYPE.LIST]).slideDown("fast",fnOpenBody);
}else{$(this._jqBody[CONST.VIEW_TYPE.LIST]).show();
fnOpenBody();
}}else{this._jqWindow.unbind("resize",this._resizeContentArea);
this._jqBody.hide();
this._bBodyOpened=false;
}}},_resizeContentArea:function($e){var nContentsAreaHeight=this._getContentsAreaHeight();
this._jqContentsArea.height(nContentsAreaHeight);
this._jqErrorText.css("margin-top",nContentsAreaHeight/2-this._jqErrorText.height()/2);
var nDetailViewWidth=this._jqDetailView.width();
nDetailViewWidth&&this._excuteContentDetailWidget("resize",nDetailViewWidth,nContentsAreaHeight);
},_getContentsAreaHeight:function(){var nWindowHeight=this._jqWindow.height();
var nAvailableHeight=nWindowHeight-(this.options.marginTop*2);
var nCurrentLayerHeight=this._jqSearchLayer.outerHeight();
var nCurrentContentsAreaHeight=this._jqContentsArea.outerHeight();
var nExContentsAreaHeight=nCurrentLayerHeight-nCurrentContentsAreaHeight;
var nLayerHeight=(nAvailableHeight<this.options.minHeight)?this.options.minHeight:(nAvailableHeight>this.options.maxHeight)?this.options.maxHeight:nAvailableHeight;
return nLayerHeight-nExContentsAreaHeight;
},_viewType:function($nViewTypeIndex){if(!arguments.length){return this._nViewTypeIndex;
}else{switch($nViewTypeIndex){case CONST.VIEW_TYPE.LIST:$(this._jqBody[CONST.VIEW_TYPE.DETAIL]).hide();
$(this._jqBody[CONST.VIEW_TYPE.LIST]).show();
this._nViewTypeIndex=CONST.VIEW_TYPE.LIST;
this._excuteContentDetailWidget("hide");
this._excuteContentWidget("isDetailView",false);
this._excuteContentWidget("update");
break;
case CONST.VIEW_TYPE.DETAIL:$(this._jqBody[CONST.VIEW_TYPE.LIST]).hide();
$(this._jqBody[CONST.VIEW_TYPE.DETAIL]).show();
this._nViewTypeIndex=CONST.VIEW_TYPE.DETAIL;
this._excuteContentWidget("isDetailView",true);
this._excuteContentDetailWidget("resize",this._jqDetailView.width(),this._getContentsAreaHeight());
break;
}return this._nViewTypeIndex;
}},_setCategorySelector:function($bShowCategorySelector){if($bShowCategorySelector){this._jqCategorySelector.njSelectBox({options:undefined,onOptionSelect:$.proxy(function($e,$oData){},this),onOptionChange:$.proxy(function($e,$oData){this._sContext=$oData.selectedValue;
},this)});
this._sContext=this._jqCategorySelector.njSelectBox("getSelectedValues")["selectedValue"];
this._jqCategorySelector.njSelectBox("show");
}else{this._jqCategorySelector.hide();
if(this._jqCategorySelector.data("ui-njSelectBox")){this._jqCategorySelector.njSelectBox("hide");
this._jqCategorySelector.njSelectBox("destroy");
}}},_setTargetSelectorStyle:function($sTargetSelectorStyle){var sTargetSelectorStyle=$sTargetSelectorStyle&&$sTargetSelectorStyle.toUpperCase();
if(!CONST.TARGET_SELECTOR_STYLE[sTargetSelectorStyle]){return false;
}switch(CONST.TARGET_SELECTOR_STYLE[sTargetSelectorStyle]){case CONST.TARGET_SELECTOR_STYLE.NONE:this._jqTargetSelectorTab.hide();
this._jqTargetSelectorRadio.show();
$(this._jqTargetSelectorRadio.children()).hide();
break;
case CONST.TARGET_SELECTOR_STYLE.TAB:this._jqTargetSelectorTab.show();
this._jqTargetSelectorRadio.hide();
break;
case CONST.TARGET_SELECTOR_STYLE.RADIO:this._jqTargetSelectorTab.hide();
this._jqTargetSelectorRadio.show();
$(this._jqTargetSelectorRadio.children()).show();
break;
}return this._sTargetSelectorStyle=sTargetSelectorStyle;
},_setTargetSelectorItems:function($aTargetSelectorItems,$nSelectedItemIndex){this._jqTargetSelectorTab.empty();
this._jqTargetSelectorRadio.empty();
if(this._sTargetSelectorStyle==CONST.TARGET_SELECTOR_STYLE.NONE){return;
}$($aTargetSelectorItems).each($.proxy(function($nIndex,$oTargetSelectorItem){var oTargetSelectorItem=$.extend({},$oTargetSelectorItem,{index:$nIndex});
$.tmpl(TEMPLATE.TARGET_SELECTOR_TAB,oTargetSelectorItem).appendTo(this._jqTargetSelectorTab);
$.tmpl(TEMPLATE.TARGET_SELECTOR_RADIO,oTargetSelectorItem).appendTo(this._jqTargetSelectorRadio);
},this));
if($aTargetSelectorItems&&$aTargetSelectorItems.length){$nSelectedItemIndex=(0<=$nSelectedItemIndex&&$nSelectedItemIndex<$aTargetSelectorItems.length)?$nSelectedItemIndex:0;
this._jqTargetSelectorTab.delegate(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE,"click",$.proxy(function($e){$e.preventDefault();
var jqSelectedTab=$($e.target);
var sSelectedValue=jqSelectedTab.attr("value");
var nSelectedIndex=jqSelectedTab.parent().index();
this._changeTargetSelectorTab(nSelectedIndex);
this._changeTargetSelectorRadioButton(nSelectedIndex);
this._nSelectedTargetIndex=nSelectedIndex;
this._sContext=sSelectedValue;
this._poweredByContextView(this._sContext);
this._search();
},this));
this._changeTargetSelectorTab($nSelectedItemIndex);
this._jqTargetSelectorRadio.delegate(SELECTOR.TARGET_SELECTOR_RADIO_SELECTABLE,"click",$.proxy(function($e){var jqSelectedRadioButton=$($e.target);
var sSelectedValue=jqSelectedRadioButton.attr("value");
var nSelectedIndex=jqSelectedRadioButton.parent().index();
this._changeTargetSelectorTab(nSelectedIndex);
this._nSelectedTargetIndex=nSelectedIndex;
this._sContext=sSelectedValue;
this._poweredByContextView(this._sContext);
this._search();
},this));
this._changeTargetSelectorRadioButton($nSelectedItemIndex);
this._nSelectedTargetIndex=$nSelectedItemIndex;
this._sContext=$aTargetSelectorItems[$nSelectedItemIndex].value;
this._poweredByContextView(this._sContext);
}},_changeTargetSelectorTab:function($nSelectedItemIndex){if(this._nSelectedTargetIndex!=undefined){var jqPrevItem=$(this._jqTargetSelectorTab.children()[this._nSelectedTargetIndex]);
jqPrevItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTED).hide();
jqPrevItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE).show();
}var jqCurrentItem=$(this._jqTargetSelectorTab.children()[$nSelectedItemIndex]);
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTED).show();
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE).hide();
},_changeTargetSelectorRadioButton:function($nSelectedItemIndex){var jqCurrentItem=$(this._jqTargetSelectorRadio.children()[$nSelectedItemIndex]);
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_RADIO_SELECTABLE).attr("checked","checked");
},_itemCounterSelected:function($nSelectedItemCount){if(!arguments.length){return this._nSelectedItemCount;
}else{($nSelectedItemCount?this._jqItemCounterSelected.addClass(CLASS.ITEM_COUNTER_SELECTED_EXIST):this._jqItemCounterSelected.removeClass(CLASS.ITEM_COUNTER_SELECTED_EXIST)).children().text($nSelectedItemCount);
return this._nSelectedItemCount=$nSelectedItemCount;
}},_itemCounterTotal:function($argument){if(!arguments.length){return this._nTotalItemCount;
}else{if(typeof $argument=="number"){this._jqItemCounterTotal.show();
this._jqItemCounterTotal.children(SELECTOR.ITEM_COUNTER_TOTAL_VALUE).text(this._nTotalItemCount=$argument);
}else{if($argument){this._jqItemCounterTotal.show();
}else{this._jqItemCounterTotal.hide();
}}}},_itemAdditionAvailableLength:function($nLength){if(!arguments.length){return this._nItemAdditionAvailableLength;
}else{if(typeof $nLength=="number"){this._nItemAdditionAvailableLength=$nLength;
}else{this._nItemAdditionAvailableLength=-1;
}}},_appendAlertWindowToCenter:function($jqAlertWindow){$jqAlertWindow.appendTo(this._jqSearchLayer).css("left",this._jqSearchLayer.outerWidth()/2-$jqAlertWindow.outerWidth()/2).css("top",this._jqSearchLayer.outerHeight()/2-$jqAlertWindow.outerHeight()/2);
return $jqAlertWindow;
},_removeAlertWindowFromCenter:function($jqAlertWindow){$jqAlertWindow.remove();
},_hasResultMore:function($flag){if($flag!==undefined){if($flag){this._changeMoreButtonToDefault();
this._jqMoreButton.show();
this._bHasResultMore=true;
}else{this._changeMoreButtonToDefault();
this._jqMoreButton.hide();
this._bHasResultMore=false;
}}return this._bHasResultMore;
},_changeMoreButtonToProgress:function(){this._jqMoreButtonDefault.hide();
this._jqMoreButtonProgress.show();
},_changeMoreButtonToDefault:function(){this._jqMoreButtonDefault.show();
this._jqMoreButtonProgress.hide();
},_noResultText:function($sQuery,$sTarget1,$sTarget2,$sCustomMessage){if($sQuery){var oNoResultText={target1:$sTarget1||TEXT.NO_RESULT_TEXT_DEFAULT_TARGET1,query:$sQuery,type:CONST.CONTENT_TYPE[this._sType].TITLE,target2:$sTarget2||TEXT.NO_RESULT_TEXT_DEFAULT_TARGET2,customMessage:$sCustomMessage};
this._jqNoResultText.append($.tmpl(TEMPLATE.NO_RESULT_TEXT,oNoResultText)).show();
}else{this._jqNoResultText.hide().empty();
}},_errorText:function($bShow){if($bShow){this._jqErrorText.show();
}else{this._jqErrorText.hide();
}},_poweredByContextView:function($sContext){var jqContainer=$(this._jqHeadArea[CONST.VIEW_TYPE.LIST]);
$(SELECTOR.POWERED_BY,jqContainer).remove();
var fnTemplate=TEMPLATE.POWERED_BY[$sContext];
if(fnTemplate){var sStaticServer=STATIC_SERVER||"http://static.naver.jp";
jqContainer.prepend($.tmpl(fnTemplate,{STATIC_SERVER:sStaticServer}));
}},getSearchQuery:function(){return this._sQuery;
}};
})("matome.mtmSearch"));
$.widget("ui.njSelectBox",(function(WIDGET_NAME){var EVENT={ON_OPTION_SELECT:"onOptionSelect",ON_OPTION_CHANGE:"onOptionChange"},CONST={OPTION_ATTRIBUTE_NAME:"njselectbox-value"},CLASS={OPTION:"njSelectBox-option"},TEMPLATE={OPTION:$.template(null,["<li ",CONST.OPTION_ATTRIBUTE_NAME,'="${value}">',"${label}","</li>"].join(""))};
var fn={getClassSelector:function($sClass){var aClasses=$.trim($sClass).split(" ");
var sClassSelector="";
for(var i=0,l=aClasses.length;
i<l;
i++){sClassSelector+=aClasses[i]?("."+aClasses[i]):"";
}return sClassSelector;
}};
return{options:{height:272,labelContainerClass:"njSelectBox-labelContainer",labelClass:"njSelectBox-label",openerClass:"njSelectBox-opener",optionContainerClass:"njSelectBox-optionContainer",optionClass:"",options:[],slideDuration:100,onOptionSelect:function(){},onOptionChange:function(){}},_create:function(){this._jqLabelContainer=$(fn.getClassSelector(this.options.labelContainerClass),this.element);
this._jqLabel=$(fn.getClassSelector(this.options.labelClass),this.element);
this._jqOpenerButton=$(fn.getClassSelector(this.options.openerClass),this.element);
this._jqOptionContainer=$(fn.getClassSelector(this.options.optionContainerClass),this.element);
this._jqOptions=this._initOptions(this.options.optionClass||undefined);
this._isOpened(false);
this._selectedValues(0);
this._initEvents();
this.height(this.options.height);
},_optionClass:function(){return this.options.optionClass||CLASS.OPTION;
},_initOptions:function($sOptionClass){if(!this._jqOptionContainer){return;
}this._jqOptionContainer.children($sOptionClass).each($.proxy(function($nIndex,$elOption){this._parseOption($nIndex,$($elOption));
},this));
var nOptionLength=this._jqOptionContainer.children().length;
for(var i=0,l=this.options.options.length;
i<l;
i++){var nIndex=nOptionLength+i;
var sLabel=this.options.options[i].label;
var sValue=this.options.options[i].value;
(sLabel!==undefined)&&(sValue!==undefined)&&this._appendOption(nIndex,sLabel,sValue);
}return this._jqOptionContainer.children();
},_parseOption:function($nIndex,$jqOption){var $sLabel=$jqOption.text();
var $sValue=$jqOption.attr(CONST.OPTION_ATTRIBUTE_NAME)||$sLabel;
if(!$sLabel||!$sValue){return;
}$jqOption.addClass(this._optionClass()).data("index",$nIndex).data("value",$sValue).data("label",$sLabel);
},_appendOption:function($nIndex,$sLabel,$sValue){this._aAppendedOptions=this._aAppendedOptions||[];
var jqNewOption=$.tmpl(TEMPLATE.OPTION,{value:$sValue,label:$sLabel}).addClass(this._optionClass()).data("index",$nIndex).data("value",$sValue).data("label",$sLabel).appendTo(this._jqOptionContainer);
this._aAppendedOptions.push(jqNewOption[0]);
return jqNewOption;
},_initEvents:function(){this._jqLabelContainer.mousedown($.proxy(function($e){$e.preventDefault();
this._toggleOptionContainer();
},this));
this._jqOptionContainer.delegate(fn.getClassSelector(this._optionClass()),"mouseup",$.proxy(function($e){this._select($($e.currentTarget));
this._isOpened(false);
},this));
},_onDocumentMouseDown:function($e){if(!this.element.has($e.target).length){this._isOpened(false);
}},_isOpened:function($bDoOpen){if(!arguments.length){return this._bIsOpened;
}else{if($bDoOpen){this.options.slideDuration?this._jqOptionContainer.slideDown(this.options.slideDuration):this._jqOptionContainer.show();
$(document).mousedown($.proxy(this._onDocumentMouseDown,this));
return this._bIsOpened=true;
}else{this.options.slideDuration?this._jqOptionContainer.slideUp(this.options.slideDuration):this._jqOptionContainer.hide();
$(document).unbind("mousedown",this._onDocumentMouseDown);
return this._bIsOpened=false;
}}},_toggleOptionContainer:function(){this._isOpened(!this._isOpened());
},_selectedValues:function($nSelectedIndex){if(!arguments.length){return{selectedIndex:this._nSelectedIndex,selectedValue:this._sSelectedValue,selectedLabel:this._sSelectedLabel};
}else{var jqSelectedOption=$(this._jqOptions[$nSelectedIndex]);
var selectedValues={selectedIndex:$nSelectedIndex,selectedValue:jqSelectedOption.data("value"),selectedLabel:jqSelectedOption.data("label")};
var nPrevIndex=((this._nSelectedIndex!==undefined)&&(this._nSelectedIndex!=$nSelectedIndex))?this._nSelectedIndex:-1;
if(nPrevIndex>=0){$.extend(selectedValues,{prevIndex:nPrevIndex,prevValue:$(this._jqOptions[nPrevIndex]).data("value"),prevLabel:$(this._jqOptions[nPrevIndex]).data("label")});
}this._nSelectedIndex=selectedValues.selectedIndex;
this._sSelectedValue=selectedValues.selectedValue;
this._sSelectedLabel=selectedValues.selectedLabel;
this._jqLabel.text(this._sSelectedLabel);
return selectedValues;
}},_select:function($oTriggered,$e){var nSelectedIndex;
var nSelectedValue;
var eTriggeredEvent=$e||null;
if($oTriggered.jquery){nSelectedIndex=$oTriggered.data("index");
nSelectedValue=$oTriggered.data("value");
}var oSelectedValues=this._selectedValues(nSelectedIndex);
this._triggerEvent(EVENT.ON_OPTION_SELECT,oSelectedValues,eTriggeredEvent);
(oSelectedValues.prevIndex!==undefined)&&this._triggerEvent(EVENT.ON_OPTION_CHANGE,oSelectedValues,eTriggeredEvent);
},_triggerEvent:function($sEventType,$oData,$eTriggeredEvent){this._trigger($sEventType,$eTriggeredEvent,$oData);
},height:function($nHeight){if($nHeight){this._jqOptionContainer.css({height:$nHeight,overflow:"auto"});
}else{this._jqOptionContainer.css({height:null,overflow:null});
}},getSelectedValues:function(){return this._selectedValues();
},show:function(){this.element.show();
},hide:function(){this._isOpened(false);
this.element.hide();
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
$(document).unbind("mousedown",this._onDocumentMouseDown);
this._aAppendedOptions&&$(this._aAppendedOptions).remove();
}};
})("ui.njSelectBox"));
})(jQuery);
(function($){nj.getPackage("nj.matome.mtmSearchItemParser",(function(OBJECT_NAME){return{getAddedItemsObject:function($sType,$aAddedItems){var fnGetItem=this[$sType&&$sType.toUpperCase()];
if(!fnGetItem||!$aAddedItems.length||!$.isArray($aAddedItems)){return null;
}var oAddedItemsObject=null,oItem,sKey;
for(var i=0,l=$aAddedItems.length;
i<l;
i++){((oItem=fnGetItem($aAddedItems[i]))&&(sKey=oItem.key))&&(!oAddedItemsObject||(oAddedItemsObject&&!oAddedItemsObject[sKey]))&&((oAddedItemsObject||(oAddedItemsObject={}))[sKey]=$.extend({},oItem.data));
}return oAddedItemsObject;
}};
})("nj.matome.mtmSearchItemParser"));
nj.getPackage("nj.matome.mtmSearchAbstractContents",(function(CLASS_NAME){var EVENT={ON_SEARCH_PROGRESS:"onSearchProgress",ON_SEARCH_COMPLETE:"onSearchComplete",ON_SEARCH_ERROR:"onSearchError",ON_SEARCH_RESULT_DATA:"onSearchResultData",ON_SEARCH_RESULT_OVERFLOW:"onSearchResultOverflow",ON_SEARCH_RESULT_END:"onSearchResultEnd",ON_SEARCH_NO_RESULT:"onSearchNoResult",ON_ITEM_SELECT:"onItemSelect",ON_ITEM_DETAIL_VIEW:"onItemDetailView"};
var SELECTOR={ADD_BUTTON_SELECTABLE:"A.mdBtn01MTM01Btn",ADD_BUTTON_CHECKED:"A.mdBtn01MTM02Btn",DETAIL_VIEW_BUTTON:"IMG._jSearchDetailView",SEARCHED_ITEM:"LI._jSearchedItem",ALERT_ADDED:"P.MdLayerAlert01"};
var CLASS={ADD_BUTTON_SELECTABLE:"mdBtn01MTM01Btn",ADD_BUTTON_CHECKED:"mdBtn01MTM02Btn",SPAN_SELECTABLE:"MdBtn01MTM01",SPAN_CHECKED:"MdBtn01MTM02"};
var TEXT={ADD_BUTTON_CHECKED:"このアイテムは追加済みです"};
var TEMPLATE={ALERT_ADDED:'<p class="MdLayerAlert01">追加しました</p>'};
return{options:{addedItems:{},alertDisplayDuration:2000,alertFadeOutDuration:200,maxItemCount:null,onSearchProgress:function(){},onSearchComplete:function(){},onSearchError:function(){},onSearchResultData:function(){},onSearchResultOverflow:function(){},onSearchResultEnd:function(){},onSearchNoResult:function(){},onItemSelect:function(){},onItemDetailView:function(){}},_create:function(){this.element.delegate(SELECTOR.ADD_BUTTON_SELECTABLE,"click",$.proxy(function($e){$e.preventDefault();
this.selectItem($($e.target).parents(SELECTOR.SEARCHED_ITEM).data("index"),$e);
},this)).delegate(SELECTOR.DETAIL_VIEW_BUTTON,"click",$.proxy(function($e){$e.preventDefault();
var jqItem=$($e.target).parents(SELECTOR.SEARCHED_ITEM);
this._trigger(EVENT.ON_ITEM_DETAIL_VIEW,$e,{index:jqItem.data("index"),key:jqItem.data("key")});
},this)).delegate(SELECTOR.ADD_BUTTON_CHECKED,"click",$.proxy(function($e){$e.preventDefault();
},this));
},_request:function($nPage,$fnAfterSearchResultData){this._trigger(EVENT.ON_SEARCH_PROGRESS,null,this._getRequestInfo());
nj.matome.mtmSearcher.request(this._getRequestOptions(this._sQuery,this._sContext,($nPage?$nPage:1),{onSuccess:$.proxy(function($oResponse){this._trigger(EVENT.ON_SEARCH_COMPLETE,null,this._getRequestInfo());
var aItemList=this._getItemList($oResponse);
var sSearchKeyword=this._getSearchKeyword($oResponse);
if(aItemList.length){var aParsedItemList=this._makeList(aItemList,sSearchKeyword);
this._isResultOverflow($oResponse)?((this._nPage<=1)&&this._trigger(EVENT.ON_SEARCH_RESULT_OVERFLOW)):this._trigger(EVENT.ON_SEARCH_RESULT_END);
this._trigger(EVENT.ON_SEARCH_RESULT_DATA,null,$.extend(this._getRequestInfo(),{dataList:aParsedItemList}));
$fnAfterSearchResultData&&$fnAfterSearchResultData.apply(null,[this._getRequestInfo()]);
}else{this._trigger(EVENT.ON_SEARCH_NO_RESULT,null,$.extend(this._getRequestInfo(),this._getAdditionalNoResultTextInfo()));
}},this),onError:$.proxy(function($oError){this._trigger(EVENT.ON_SEARCH_ERROR,null,this._getRequestInfo());
},this)}));
},_getRequestInfo:function(){return{query:this._sQuery,context:this._sContext,page:this._nPage};
},_getSearchKeyword:function($oResponse){return this._sQuery;
},_getAdditionalNoResultTextInfo:function(){return null;
},_makeList:function($aItemList,$sSearchKeyword){var aParsedItemList=[];
$($aItemList).each($.proxy(function($nIndex,$oItem){var oItemData=this._getParsedItemData($oItem,$sSearchKeyword);
var nItemIndex=this._nPage*this.options.itemsPerPage+$nIndex;
aParsedItemList.push(oItemData);
this._checkAddedItem($(this._getItemElement(oItemData,nItemIndex)).appendTo(this.element));
},this));
this._nPage++;
return aParsedItemList;
},_checkAddedItem:function($jqItem){var sKey=$jqItem.data("key");
var nIndex=$jqItem.data("index");
if(this.options.addedItems&&this.options.addedItems[sKey]){this.checkItem({index:nIndex},true);
return true;
}return false;
},_getParsedItemData:function($oItem,$sSearchKeyword){return $.extend(this._refineData($oItem,this._sContext),{searchKeyword:$sSearchKeyword});
},_refineData:function($oEntry){return $oEntry;
},search:function($sQuery,$sContext){this._sQuery=$sQuery;
this._sContext=$sContext;
this._request(this._nPage=0);
},searchMore:function($fnAfterSearchResultData){if(!this._sQuery){return false;
}this._request(this._nPage+1,$fnAfterSearchResultData);
},checkItem:function($oSelectedItem,$bIsDuplicated){var jqSelectedItem=$oSelectedItem.jquery?$oSelectedItem:(($oSelectedItem.index!==undefined)?$(this.element.children()[$oSelectedItem.index]):null);
if(!jqSelectedItem){return;
}var jqButton=$(SELECTOR.ADD_BUTTON_SELECTABLE,jqSelectedItem);
jqButton.removeClass(CLASS.ADD_BUTTON_SELECTABLE).addClass(CLASS.ADD_BUTTON_CHECKED).attr("title",TEXT.ADD_BUTTON_CHECKED).text(TEXT.ADD_BUTTON_CHECKED).parent().removeClass(CLASS.SPAN_SELECTABLE).addClass(CLASS.SPAN_CHECKED);
jqSelectedItem.addClass("ExSeleted");
!$bIsDuplicated&&jqSelectedItem.append($(TEMPLATE.ALERT_ADDED)).children(SELECTOR.ALERT_ADDED).delay(this.options.alertDisplayDuration).fadeOut(this.options.alertFadeOutDuration,function(){$(this).remove();
});
},selectItem:function($nIndex,$e){var jqSelectedItem=$(this.element.children()[$nIndex]);
var sKey=jqSelectedItem.data("key");
var oData=jqSelectedItem.data("data");
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:$nIndex,key:sKey,data:oData});
},getItemByIndex:function($nIndex){return $(this.element.children()[$nIndex]);
},getAdditionLimitMessage:function(){return null;
}};
})("nj.matome.mtmSearchAbstractContents"));
nj.getPackage("nj.matome.mtmSearchAbstractDefault",(function(CLASS_NAME,$super){var CONST={API_URL:{INTERNAL_SEARCH:"http://partner.api.naver.jp/search/1.0",EXTERNAL_SEARCH:nj.getCombinedUrl(nj.getBaseUrl(),"externalsearch")},TYPE:{INTERNAL_SEARCH:{IMAGE:"image",VIDEO:"video",LINK:"web"},EXTERNAL_SEARCH:{IMAGE:"image",VIDEO:"video",LINK:"url"}},TARGET:{INTERNAL_SEARCH:"naver"},JSONP_CALLBACK_NAME:"_callback"};
return $.extend(true,{},nj.matome.mtmSearchAbstractContents,{_getRequestOptions:function($sQuery,$sTarget,$nPage,$oCallbacks){var bIsInternalSearch=($sTarget==CONST.TARGET.INTERNAL_SEARCH);
var sUrl=bIsInternalSearch?nj.getCombinedUrl(CONST.API_URL.INTERNAL_SEARCH,CONST.TYPE.INTERNAL_SEARCH[this._sType]):CONST.API_URL.EXTERNAL_SEARCH;
var oRequestData={q:$sQuery,start:parseInt($nPage-1)*this.options.itemsPerPage+1,display:this.options.itemsPerPage,siteId:"p_matome",partnerId:"naver","$format":"json"};
if(!bIsInternalSearch){$.extend(oRequestData,{type:CONST.TYPE.EXTERNAL_SEARCH[this._sType],target:$sTarget});
}var oRequestOptions={requester:"ajax",url:sUrl,data:oRequestData,dataType:bIsInternalSearch?"jsonp":"json"};
if(oRequestOptions.dataType=="jsonp"){oRequestOptions.jsonp=CONST.JSONP_CALLBACK_NAME;
}return $.extend(oRequestOptions,{onSuccess:function($oResponse){$oCallbacks.onSuccess.apply(null,arguments);
},onError:function(){$oCallbacks.onError.apply(null,arguments);
}});
},_isResultOverflow:function($oResponse){var nTotal,nStart,nPerPage,nSum,nMax=this.option("maxItemCount");
if($oResponse.opensearch){nTotal=parseInt($oResponse.opensearch.totalResults);
nStart=parseInt($oResponse.opensearch.startIndex);
nPerPage=parseInt($oResponse.opensearch.itemsPerPage);
}else{nTotal=parseInt($oResponse["n$options"]["n$maxIndex"]["$t"]);
nStart=parseInt($oResponse["n$options"]["n$startIndex"]["$t"]);
nPerPage=parseInt($oResponse["n$options"]["n$itemsPerPage"]["$t"]);
}nSum=nStart+nPerPage;
if(nMax&&this._sContext==="naver"&&nSum>nMax){return false;
}return nTotal>nSum?true:false;
},_getItemList:function($oResponse){var a;
if($oResponse.d){a=$oResponse.d.results&&$oResponse.d.results.length?$oResponse.d.results:[];
}else{a=$oResponse.entry.length?$oResponse.entry:[];
}return a;
},_getSearchKeyword:function($oResponse){var s;
if($oResponse.opensearch){s=$oResponse.opensearch.searchTerms||this._sQuery;
}else{s=$oResponse["opensearch$Query"]["searchTerms"]||this._sQuery;
}return s;
},_getParsedItemData:function($oItem,$sSearchKeyword){return $.extend(this._refineData($oItem,this._sContext),{searchKeyword:$sSearchKeyword,collectionType:this._getCollectionType(this._sContext)});
},_checkThumbType:function(oEntry,sSize){var sUrl="";
var o=oEntry["n$image"]||oEntry.image;
if(typeof o!=="undefined"){var sThumb;
if(o instanceof Array&&o.length){o=o[0];
}if(o.n$thumbnail){sThumb=o["n$thumbnail"]["$t"];
}else{if(o.thumbnailUrlNew){sThumb=o.thumbnailUrlNew.replace(/(size=\d+x\d+)/,"size=150x0");
}else{sThumb=o.thumbnailUrl;
}}sThumb=sThumb||"";
if(/\?.*type=etc[123]/i.test(sThumb)){sUrl=sThumb.replace(/(\?.*)(type=etc[123])/i,"$1type=etc"+sSize);
}else{if(/.*\/r.[0-9]{2,3}x[0-9]{2,3}/i.test(sThumb)){sUrl=sThumb.replace(/(.*\/r.)([0-9]{2,3}x[0-9]{2,3})/i,"$1150x0");
}else{sUrl=sThumb.replace(/120\/120$/,"160/140");
sUrl=sThumb.replace(/(size=\d+x\d+)/,"size=150x0");
}}}return sUrl;
},_cutStr:function(sText,nSize){var oStr=nj.cutStr(sText,nSize,{jp:11,upper:8,lower:6,others:6,regTag:"b"});
return oStr.size>88?oStr.str+"...":oStr.str;
},selectItem:function($nIndex,$e){$super.selectItem.apply(this,arguments);
},checkItem:function($nIndex,$e){$super.checkItem.apply(this,arguments);
}});
})("nj.matome.mtmSearchAbstractDefault",nj.matome.mtmSearchAbstractContents));
nj.getPackage("nj.matome.mtmSearcher",(function(OBJECT_NAME){return{getLastCallbacks:function($oCallbacks,$oTarget){if((typeof $oCallbacks!=="function")&&(typeof $oCallbacks!=="object")&&($oCallbacks===undefined)){return null;
}$oTarget._nLastCallbackId=$.now();
var getCallback=function($fnCallback){var fnCallback=function(){if(fnCallback.id!=$oTarget._nLastCallbackId){return;
}$oTarget._nLastCallbackId=null;
delete $oTarget._nLastCallbackId;
$fnCallback&&$fnCallback.apply(null,arguments);
};
fnCallback.id=$oTarget._nLastCallbackId;
return fnCallback;
};
if(typeof $oCallbacks=="function"){return getCallback($oCallbacks);
}else{if(typeof $oCallbacks=="object"){var oCallbacks=null;
for(var s in $oCallbacks){if(typeof $oCallbacks[s]=="function"){oCallbacks=oCallbacks||{};
oCallbacks[s]=getCallback($oCallbacks[s]);
}}return oCallbacks;
}else{return null;
}}},ajax:function($oOptions,$fnSuccess,$fnError){var fnLastCallBacks=this.getLastCallbacks({success:function($oResponse){$fnSuccess.apply(null,arguments);
},error:function(){$fnError.apply(null,arguments);
}},this),o=$.extend($oOptions,{success:fnLastCallBacks.success,error:fnLastCallBacks.error});
if(o.dataType==="jsonp"&&$.jsonp){$.jsonp($.extend(o,{callback:"jQuery_jsonp_"+(+new Date),callbackParameter:o.jsonp||"callback",complete:$.noop}));
}else{$.ajax(o);
}},rest:function($sMethod,$oOptions,$fnSuccess,$fnError){if(!$sMethod){return;
}var fnLastCallBacks=this.getLastCallbacks({success:function($oResponse){$fnSuccess.apply(null,arguments);
},error:function(){$fnError.apply(null,arguments);
}},this);
$.rest($sMethod,$.extend($oOptions,{success:fnLastCallBacks.success,error:fnLastCallBacks.error}));
},request:function($oOptions){$oOptions=$.extend(true,{requester:"",method:"",dataType:"",url:"",data:null,onSuccess:function(){},onError:function(){}},$oOptions);
var sRequester=$oOptions.requester.toLowerCase();
if(typeof this[sRequester]!=="function"){return;
}var sUrl=$oOptions.url;
var oData=$oOptions.data;
var fnSuccess=$oOptions.onSuccess;
var fnError=$oOptions.onError;
if(!sUrl){return;
}var oRequestOptions={url:sUrl,data:oData};
switch(sRequester){case"ajax":var sDataType=$oOptions.dataType.toLowerCase();
oRequestOptions.dataType=sDataType;
if($oOptions.dataType=="jsonp"&&$oOptions.jsonp){oRequestOptions.jsonp=$oOptions.jsonp;
}this.ajax(oRequestOptions,fnSuccess,fnError);
break;
case"rest":var sMethod=$oOptions.method.toUpperCase();
oRequestOptions.data=oRequestOptions.data?$.toJSON(oRequestOptions.data):null;
this.rest(sMethod,oRequestOptions,fnSuccess,fnError);
break;
}}};
})("nj.matome.mtmSearcher"));
})(jQuery);
(function($){nj.getPackage("nj.matome.mtmSearchAbstractDetail",(function(CLASS_NAME){var EVENT={ON_ITEM_SELECT:"onItemSelect",ON_PREV:"onPrev",ON_NEXT:"onNext"};
var CONST={KEY_CODE:{LEFT_ARROW:37,RIGHT_ARROW:39,ENTER:13}};
var SELECTOR={KEY_EVENT_TARGET:document,ADD_BUTTON_SELECTABLE:"A.MdBtn02MTM01",ADD_BUTTON_CHECKED:"SPAN.MdBtn02MTM02",CONTENT_DETAIL_VIEW:"DIV._jContentDetailView",CONTENT_CONTAINER:"DIV._jContentContainer",PREV_PAGE_BUTTON:"A.mdSearchView01PaginationPrev",NEXT_PAGE_BUTTON:"A.mdSearchView01PaginationNext"};
var CLASS={PAGE_BUTTON_CLICKED:"ExHover"};
var TEMPLATE={ALERT_ADDED:$.template(null,['<p class="MdLayerAlert01">追加しました</p>'].join(""))};
return{options:{alertDisplayDuration:2000,alertFadeOutDuration:200,contentMaxWidth:720,contentMaxHeight:700,onItemSelect:function(){},onPrev:function(){},onNext:function(){}},_create:function(){this._jqAddButtonSelectable=$(SELECTOR.ADD_BUTTON_SELECTABLE,this.element).click($.proxy(function($e){$e.preventDefault();
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:this._nCurrentIndex});
},this));
this._jqAddButtonChecked=$(SELECTOR.ADD_BUTTON_CHECKED,this.element);
this._jqPrevPageButton=$(SELECTOR.PREV_PAGE_BUTTON,this.element).click($.proxy(function($e){$e.preventDefault();
this._prev($e);
},this));
this._jqNextPageButton=$(SELECTOR.NEXT_PAGE_BUTTON,this.element).click($.proxy(function($e){$e.preventDefault();
this._next($e);
},this));
this._jqContentDetailView=$(SELECTOR.CONTENT_DETAIL_VIEW,this.element);
this._jqContentContainer=$(SELECTOR.CONTENT_CONTAINER,this.element);
},_setPageButton:function($nSelectedIndex,$nDataListLength,$bHasResultMore){if(!$nSelectedIndex){this._jqPrevPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqPrevPageButton.hide();
this._bIsFirstItem=true;
}else{this._jqPrevPageButton.show();
this._bIsFirstItem=false;
}if(!$bHasResultMore&&($nSelectedIndex>=$nDataListLength-1)){this._jqNextPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqNextPageButton.hide();
this._bIsLastItem=true;
}else{this._jqNextPageButton.show();
this._bIsLastItem=false;
}},_addButton:function($bIsAdded){if(!arguments.length){return this._bIsAdded;
}else{if($bIsAdded){this._jqAddButtonSelectable.hide();
this._jqAddButtonChecked.show();
this._bIsAdded=true;
}else{this._jqAddButtonSelectable.show();
this._jqAddButtonChecked.hide();
this._bIsAdded=false;
}}},_getScaledSize:function($oTargetSize,$oLimitSize,$bFitToLimitSize){var nRatio=Math.min($oLimitSize.width/$oTargetSize.width,$oLimitSize.height/$oTargetSize.height);
nRatio=$bFitToLimitSize?nRatio:Math.min(nRatio,1);
return{width:parseInt($oTargetSize.width*nRatio),height:parseInt($oTargetSize.height*nRatio)};
},_getCenteredPosition:function($oTargetSize,$oLimitSize){return{top:parseInt(($oTargetSize.height&&($oTargetSize.height<$oLimitSize.height))?($oLimitSize.height-$oTargetSize.height)/2:0),left:parseInt(($oTargetSize.width&&($oTargetSize.width<$oLimitSize.width))?($oLimitSize.width-$oTargetSize.width)/2:0)};
},_alertAdded:function($bShow){if($bShow!==undefined){if($bShow){this._jqAlertAdded=this._jqAlertAdded||$.tmpl(TEMPLATE.ALERT_ADDED);
this._jqContentContainer.after(this._jqAlertAdded);
this._jqAlertAdded.css({top:this._getCenteredPosition({width:this._jqAlertAdded.width(),height:this._jqAlertAdded.height()},this._oLimitSize).top,"margin-top":0});
this._jqAlertAdded.delay(this.options.alertDisplayDuration).fadeOut(this.options.alertFadeOutDuration,$.proxy(function(){this._jqAlertAdded.remove();
this._jqAlertAdded=null;
},this));
}else{this._jqAlertAdded&&this._jqAlertAdded.clearQueue("fx").stop().remove();
this._jqAlertAdded=null;
}}return this._jqAlertAdded;
},_setKeyShortcut:function($enable){if($enable){if(this._isKeyShortcutEnabled){return;
}$(SELECTOR.KEY_EVENT_TARGET).keydown($.proxy(this._onKeydown,this));
$(SELECTOR.KEY_EVENT_TARGET).keyup($.proxy(this._onKeyup,this));
this._isKeyShortcutEnabled=true;
}else{$(SELECTOR.KEY_EVENT_TARGET).unbind("keydown",this._onKeydown);
$(SELECTOR.KEY_EVENT_TARGET).unbind("keyup",this._onKeyup);
this._isKeyShortcutEnabled=false;
}},_isFocusOnInput:function($e){return($e.target.tagName=="INPUT");
},_onKeydown:function($e){if(this._isFocusOnInput($e)){return;
}var nKeyCode=$e.keyCode;
if(nKeyCode==CONST.KEY_CODE.LEFT_ARROW&&!this._bIsFirstItem){this._jqPrevPageButton.addClass(CLASS.PAGE_BUTTON_CLICKED);
}else{if(nKeyCode==CONST.KEY_CODE.RIGHT_ARROW&&!this._bIsLastItem){this._jqNextPageButton.addClass(CLASS.PAGE_BUTTON_CLICKED);
}}},_onKeyup:function($e){if(this._isFocusOnInput($e)){return;
}var nKeyCode=$e.keyCode;
if(nKeyCode==CONST.KEY_CODE.LEFT_ARROW&&!this._bIsFirstItem){this._jqPrevPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqPrevPageButton.click();
}else{if(nKeyCode==CONST.KEY_CODE.RIGHT_ARROW&&!this._bIsLastItem){this._jqNextPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqNextPageButton.click();
}else{if(nKeyCode==CONST.KEY_CODE.ENTER){if(this._addButton()){return;
}this._jqAddButtonSelectable.click();
}}}},_prev:function($e){this._trigger(EVENT.ON_PREV,$e,{index:this._nCurrentIndex});
},_next:function($e){this._trigger(EVENT.ON_NEXT,$e,{index:this._nCurrentIndex});
},resize:function($nWidth,$nHeight){this._oLimitSize={width:parseInt(Math.min(this.options.contentMaxWidth,$nWidth)),height:parseInt($nHeight)};
this._jqPrevPageButton.height(this._oLimitSize.height);
this._jqNextPageButton.height(this._oLimitSize.height);
this._jqContentDetailView.height(this._oLimitSize.height);
},show:function($oOptions){$oOptions=$.extend({},{index:undefined,data:undefined,listLength:undefined,hasResultMore:undefined,isAdded:undefined},$oOptions);
this._alertAdded()&&this._alertAdded(false);
this._nCurrentIndex=$oOptions.index;
this._setPageButton($oOptions.index,$oOptions.listLength,$oOptions.hasResultMore);
this._addButton($oOptions.isAdded);
this._setContent($oOptions.data);
this._setKeyShortcut(true);
},check:function($bIsDuplicated){this._addButton(true);
!$bIsDuplicated&&this._alertAdded(true);
},hide:function(){this._alertAdded()&&this._alertAdded(false);
this._nCurrentIndex=undefined;
this._bIsFirstItem=false;
this._bIsLastItem=false;
this._jqContent=null;
this._jqContentContainer.empty();
this._setKeyShortcut(false);
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
this.hide();
}};
})("nj.matome.mtmSearchAbstractDetail"));
$.widget("matome.mtmSearchImageDetail",(function(WIDGET_NAME,$super){var CONST={LOADING_IMAGE:{SRC:"matome_ver4/img/js/searchLayer_Loading.gif",WIDTH:24,HEIGHT:24}},CLASS={CONTENT_DETAIL_VIEW:"MdSearchView01",CONTENT_CONTAINER:"mdSearchView01Thumb"},TEMPLATE={IMAGE:"<img />"};
return $.extend(true,{},nj.matome.mtmSearchAbstractDetail,{_create:function(){$super._create.apply(this,arguments);
this._jqContentDetailView.addClass(CLASS.CONTENT_DETAIL_VIEW);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER);
},_loadImage:function($oOptions){$oOptions=$.extend({},{src:"",onSuccess:function(){},onError:function(){}},$oOptions);
if(!$oOptions.src){return;
}var fnSuccess=$oOptions.onSuccess;
var fnError=$oOptions.onError;
var jqImage=$(new Image());
var fnLastCallBacks=nj.matome.mtmSearcher.getLastCallbacks({onSuccess:function($e){fnSuccess&&fnSuccess.apply(null,[{element:jqImage[0],src:jqImage.attr("src"),width:jqImage.attr("width"),height:jqImage.attr("height")}]);
},onError:function($e){fnError&&fnError.apply(null,[{element:jqImage[0],src:jqImage.attr("src"),width:jqImage.attr("width"),height:jqImage.attr("height")}]);
}},this);
jqImage.load(fnLastCallBacks.onSuccess);
jqImage.error(fnLastCallBacks.onError);
jqImage.attr("src",this._oImageInfo.src);
},_setContent:function($oData){this._jqContent=this._jqContent||this._getContent();
this._onLoadingImage(true);
this._oImageInfo=$.extend(this._oImageInfo||{},{src:$oData.originalUrl,alt:$oData.originalTitle,width:$oData.width,height:$oData.height});
this._loadImage({src:this._oImageInfo.src,onSuccess:$.proxy(function($oImage){if(!this._oImageInfo){return;
}if(!this._oImageInfo.width||!this._oImageInfo.height){this._oImageInfo.width=$oImage.width;
this._oImageInfo.height=$oImage.height;
}this._onLoadingImage(false);
this._resizeImage();
this._jqContent.hide().load($.proxy(function($e){this._jqContent.show();
},this)).attr({src:this._oImageInfo.src,alt:this._oImageInfo.alt});
},this),onError:$.proxy(function($oImage){if(!this._oImageInfo){return;
}var oErrorImage=errorImage.get("default");
var nWidth=oErrorImage.w;
var nHeight=oErrorImage.h;
this._oImageInfo.width=nWidth;
this._oImageInfo.height=nHeight;
this._onLoadingImage(false);
this._resizeImage();
this._jqContent.attr({src:oErrorImage.src,width:nWidth,height:nHeight});
},this)});
},_onLoadingImage:function($bDoShow){if(!arguments.length){return this._oLoadingImageInfo;
}else{if($bDoShow){this._jqContent.attr({src:nj.getCombinedUrl(window.STATIC_SERVER,CONST.LOADING_IMAGE.SRC)});
this._oLoadingImageInfo={width:CONST.LOADING_IMAGE.WIDTH,height:CONST.LOADING_IMAGE.HEIGHT};
this._resizeImage();
}else{this._oLoadingImageInfo=null;
}}},_getContent:function(){return $(TEMPLATE.IMAGE).appendTo(this._jqContentContainer);
},_resizeImage:function(){if(!this._jqContent){return;
}var oScaledSize=this._getScaledSize(this._oLoadingImageInfo||{width:this._oImageInfo.width,height:this._oImageInfo.height},this._oLimitSize);
var nTop=this._getCenteredPosition(oScaledSize,this._oLimitSize).top;
this._jqContent.attr({width:oScaledSize.width,height:oScaledSize.height}).css({top:nTop});
},resize:function($nWidth,$nHeight){$super.resize.apply(this,arguments);
this._oImageInfo&&this._resizeImage();
},hide:function(){$super.hide.apply(this,arguments);
this._oImageInfo=null;
},destroy:function(){$super.destroy.apply(this,arguments);
this._jqContentDetailView.removeClass(CLASS.CONTENT_DETAIL_VIEW);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER);
}});
})("matome.mtmSearchImageDetail",nj.matome.mtmSearchAbstractDetail));
$.widget("matome.mtmSearchVideoDetail",(function(WIDGET_NAME,$super){var CONST={NO_THUMB_WIDTH:120,NO_THUMB_HEIGHT:90},CLASS={CONTENT_DETAIL_VIEW:"MdSearchView02",CONTENT_CONTAINER_MOVIE:"mdSearchView02Thumb",CONTENT_CONTAINER_NO_MOVIE:"MdSearchNone01"},TEMPLATE={NO_MOVIE:$.template(null,['<div style="position:relative">','<div class="mdSearchNone01Thumb">','<img alt="" ','width="${width}" ','height="${height}" ','src="${thumbUrl}"',">","{{if playTime}}",'<span class="MdLayerVideoTime01">',"${playTime}","</span>","{{/if}}","</div>",'<p class="MdMarginTop12"><a class="MdLink04 MdColor06" target="_blank" href="${sourceUrl}" data-na="NL:url">${source}</a></p>','<p class="MdMarginTop12 MdColor03">こちらの動画はこのページ上では再生できません。<br>下記のリンクより動画を確認できます。</p>','<p class="MdMarginTop15"><a class="MdLink03 MdColor04" target="_blank" href="${originalUrl}" data-na="NL:url">動画を確認する</a></p>',"</div>"].join(""))};
return $.extend(true,{},nj.matome.mtmSearchAbstractDetail,{_create:function(){$super._create.apply(this,arguments);
this._jqContentDetailView.addClass(CLASS.CONTENT_DETAIL_VIEW);
},_getContent:function($oData){if(this._oVideoFilter){this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER_MOVIE);
if(this._oVideoFilter.url.match("nicovideo.jp")){mFilter.setNico($oData.url,this._jqContentContainer,this._oVideoFilter.width,this._oVideoFilter.height,$.proxy(function($e){var jqNicoVideo=$(this._jqContentContainer.children()[0]);
if(jqNicoVideo.length){this._jqContent=jqNicoVideo.css({position:"relative"});
this._repositionVideo();
}},this));
return null;
}else{var jqObject=$(this._oVideoFilter.html).appendTo(this._jqContentContainer).css({position:"relative"});
var jqEmbed=$("EMBED",jqObject).css({position:"relative"});
if($.browser.msie){$.ui.njVideoFilter.prototype.checkVideoCleanUp(this._jqContentContainer);
}return $.browser.msie||!jqEmbed.length?jqObject:jqEmbed;
}}else{this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_MOVIE);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
return $.tmpl(TEMPLATE.NO_MOVIE,$.extend({},$oData,{width:CONST.NO_THUMB_WIDTH,height:CONST.NO_THUMB_HEIGHT})).appendTo(this._jqContentContainer);
}},_setContent:function($oData){this._oVideoFilter=mFilter.html($oData.originalUrl);
this._jqContent&&this._jqContentContainer.empty();
this._jqContent=this._getContent($oData);
this._jqContent&&this._repositionVideo();
},_repositionVideo:function(){var oPosition=this._getCenteredPosition({width:this._jqContent.width(),height:this._jqContent.height()},this._oLimitSize);
this._jqContent.css({top:oPosition.top});
},resize:function($nWidth,$nHeight){$super.resize.apply(this,arguments);
this._jqContent&&this._repositionVideo();
},destroy:function(){$super.destroy.apply(this,arguments);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_MOVIE);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
this._jqContentDetailView.removeClass(CLASS.CONTENT_DETAIL_VIEW);
this._oVideoFilter=null;
}});
})("matome.mtmSearchVideoDetail",nj.matome.mtmSearchAbstractDetail));
})(jQuery);
(function($){$.widget("matome.mtmSearchImage",(function(WIDGET_NAME,$super){var EVENT={ON_ITEM_SELECT:"onItemSelect"};
var CONST={TYPE:"IMAGE",COLLECTION_TYPE:{naver:"IMAGE",google:"GOOGLE_IMAGE",flickr:"FLICKR"},THUMBNAIL_WIDTH:150,MARGIN:10};
var CLASS={NOT_RENDERED_ITEM_CONTAINER:"_jNotRenderedElements"};
var TEMPLATE={NOT_RENDERED_ITEM_CONTAINER:"<ul class='_jNotRenderedElements' style='display:none;' />",ITEM:$.template(null,['<li class="_jSearchedItem">','<div class="mdSearchList01Thumb">','<img data-na="NC:detailView" ','class="_jSearchDetailView" onerror="errorImage(this, \'default\');" ','src="${thumbUrl}" ','width="${thumbWidth}" ','height="${thumbHeight}" ',">","</div>",'<p class="mdSearchList01BtnMTM"><span class="MdBtn01MTM01"><a title="追加" class="mdBtn01MTM01Btn" href="#" data-na="NC:addItem">追加</a></span></p>',"</li>"].join(""))};
return $.extend(true,{},nj.matome.mtmSearchAbstractDefault,{options:{itemsPerPage:50,maxItemCount:2000},_init:function(){this._sType=CONST.TYPE;
},_makeList:function($aItemList,$sSearchKeyword){if(!this._nPage){this._notRenderedElements(null);
}var aParsedItemList=[];
var aItemElements=[];
$($aItemList).each($.proxy(function($nIndex,$oItem){var oItemData=this._getParsedItemData($oItem,$sSearchKeyword);
var nItemIndex=this._nPage*this.options.itemsPerPage+$nIndex;
aParsedItemList.push(oItemData);
aItemElements.push(this._getItemElement(oItemData,nItemIndex));
},this));
this._nPage++;
this.isDetailView()?this._notRenderedElements(aItemElements):this._render(aItemElements);
return aParsedItemList;
},_notRenderedElements:function($aItemElements){if(!arguments.length){return this._jqNotRenderedElements&&this._jqNotRenderedElements.children();
}else{if($aItemElements&&$.isArray($aItemElements)){this._jqNotRenderedElements=this._jqNotRenderedElements||$(TEMPLATE.NOT_RENDERED_ITEM_CONTAINER).prependTo(this.element.parent());
return this._jqNotRenderedElements.append($aItemElements);
}else{this.element.parent().children(CLASS.NOT_RENDERED_ITEM_CONTAINER).empty().remove();
this._jqNotRenderedElements&&this._jqNotRenderedElements.empty().remove();
return this._jqNotRenderedElements=null;
}}},_render:function($aItemElements){this.element.append($aItemElements);
$($aItemElements).each($.proxy(function($nIndex,$oItem){this._checkAddedItem($($oItem));
},this));
if(this._nPage==1){this.element.masonry({columnWidth:CONST.THUMBNAIL_WIDTH+CONST.MARGIN,resizeable:false,itemSelector:"LI"});
}else{this.element.masonry("reload");
}},_refineData:function(oEntry,sTab){var oSize,oRefinedData;
if(oEntry["n$image"]){oSize=this._getSize({image:oEntry["n$image"],width:oEntry["n$image"]["n$source"]["width"],height:oEntry["n$image"]["n$source"]["height"]},sTab);
oRefinedData={thumbUrl:this._checkThumbType(oEntry,""),originalUrl:oEntry.link["$t"],originalTitle:oEntry["n$originalTitle"]["$t"],fileSize:oEntry["n$fileSize"]["$t"],imageResolution:oEntry["n$image"]["n$source"]["width"]+"x"+oEntry["n$image"]["n$source"]["height"],shortSourceUrl:this._cutStr(oEntry["n$pgroupUrl"]["$t"],143),source:oEntry["n$domainName"]["$t"],sourceUrl:oEntry["n$pgroupUrl"]["$t"],width:oSize.width,height:oSize.height,thumbWidth:oSize.thumbWidth,thumbHeight:oSize.thumbHeight};
}else{oSize=this._getSize({image:oEntry.image,width:oEntry.image.width,height:oEntry.image.height},sTab);
oRefinedData={thumbUrl:this._checkThumbType(oEntry,""),originalUrl:oEntry.url,originalTitle:oEntry.originalTitle,fileSize:oEntry.fileSize,imageResolution:oEntry.image.width+"x"+oEntry.image.height,shortSourceUrl:this._cutStr(oEntry.refererUrl,143),source:oEntry.domainName,sourceUrl:oEntry.refererUrl,width:oSize.width,height:oSize.height,thumbWidth:oSize.thumbWidth,thumbHeight:oSize.thumbHeight};
}return oRefinedData;
},_getItemElement:function($oItemData,$nItemIndex){var oTemplateData=$.extend({},$oItemData);
return $.tmpl(TEMPLATE.ITEM,oTemplateData).data("index",$nItemIndex).data("key",$oItemData.originalUrl).data("data",$oItemData)[0];
},_getCollectionType:function($sTarget){return CONST.COLLECTION_TYPE[$sTarget]||"";
},_getSize:function(oEntry,sTab){var outSize=(sTab=="flickr")?{width:150,height:115}:{width:150,height:0};
var oSize={};
if(oEntry.image instanceof Array){newSize=this._convertThumbnailSize(outSize.width,outSize.height,oEntry.width,oEntry.height);
oSize.width=parseInt(oEntry.width,10);
oSize.height=parseInt(oEntry.height,10);
oSize.thumbWidth=Math.floor(newSize.width);
oSize.thumbHeight=Math.floor(newSize.height);
}else{newSize=this._convertThumbnailSize(outSize.width,outSize.height,oEntry.width,oEntry.height);
oSize.width=parseInt(oEntry.width,10);
oSize.height=parseInt(oEntry.height,10);
oSize.thumbWidth=Math.floor(newSize.width);
oSize.thumbHeight=Math.floor(newSize.height);
}return oSize;
},_convertThumbnailSize:function(newWidth,newHeight,width,height){newWidth=parseInt(newWidth,10);
newHeight=parseInt(newHeight,10);
width=parseInt(width,10);
height=parseInt(height,10);
var retWidth=newWidth;
var retHeight=newHeight;
if(newHeight==0){retHeight=newWidth*height/width;
return{width:Math.floor(retWidth),height:Math.floor(retHeight)};
}if((width>newWidth)||(height>newHeight)){if(newWidth>newHeight){if(width==height){retWidth=newHeight;
}else{if(width>height){if(width>newWidth){var tempHeight=newWidth*height/width;
if(tempHeight>newHeight){retWidth=newHeight*width/height;
}else{retHeight=tempHeight;
}}else{if(height>newHeight){retWidth=newHeight*width/height;
}}}else{if(height>newHeight){var tempWidth=newHeight*width/height;
if(tempWidth>newWidth){retHeight=newWidth*height/width;
}else{retWidth=tempWidth;
}}else{if(width>newWidth){retHeight=newWidth*height/width;
}}}}}else{if(newWidth<newHeight){if(width==height){retHeight=newWidth;
}else{if(width>height){if(height>newHeight){var tempWidth=newHeight*width/height;
if(tempWidth>newWidth){retHeight=newWidth*height/width;
}else{retWidth=tempWidth;
}}else{if(width>newWidth){retHeight=newWidth*height/width;
}}}else{if(width>newWidth){var tempHeight=newWidth*height/width;
if(tempHeight>newHeight){retWidth=newHeight*width/height;
}else{retHeight=tempHeight;
}}else{if(height>newHeight){retWidth=newHeight*width/height;
}}}}}else{if(width>height){retHeight=newWidth*height/width;
}else{if(width<height){retWidth=newHeight*width/height;
}}}}}else{retWidth=(width==0)?newWidth:width;
retHeight=(height==0)?newHeight:height;
}return{width:Math.floor(retWidth),height:Math.floor(retHeight)};
},isDetailView:function($isDetailView){if(!arguments.length){return this._bIsDetailView;
}else{switch($isDetailView){case true:this._bIsDetailView=true;
break;
case false:this._bIsDetailView=false;
break;
}}},update:function(){if(this._notRenderedElements()){var aNotRenderedElements=this._notRenderedElements();
$(aNotRenderedElements).appendTo(this.element);
}this.element.masonry("reload");
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
this._notRenderedElements(null);
},selectItem:function($nIndex,$e){if(this.element.children()[$nIndex]){$super.selectItem.apply(this,arguments);
}else{var nIndex=$nIndex-this.element.children().length;
var jqSelectedItem=$(this._notRenderedElements()[nIndex]);
var sKey=jqSelectedItem.data("key");
var oData=jqSelectedItem.data("data");
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:$nIndex,key:sKey,data:oData});
}},checkItem:function($oSelectedItem,$bIsDuplicated){if(this.element.children()[$oSelectedItem.index]){$super.checkItem.apply(this,arguments);
}else{var nIndex=$oSelectedItem.index-this.element.children().length;
var jqSelectedItem=$(this._notRenderedElements()[nIndex]);
$super.checkItem.apply(this,[jqSelectedItem,false]);
}},getItemByIndex:function($nIndex){return $(this.element.children()[$nIndex]||this._notRenderedElements()[$nIndex-this.element.children().length]);
}});
})("matome.mtmSearchImage",nj.matome.mtmSearchAbstractDefault));
})(jQuery);
nj.common.setAPI({BOOKMARK_CHECK:"/api/bookmark/check",BOOKMARK_ADD:"/api/bm/v2/bookmarks",BOOKMARK_UPDATE:"/api/bm/v2/bookmarks/${bookmarkId}/update",FAVORITE_REMOVE:"/api/bm/v2/bookmarks/delete",FAVORITE_LIST:"/api/bm/v2/bookmarks",FAVORITE_LIST_SEARCH:"/api/bm/v2/bookmarks/search",FAVORITE_ITEM:"/api/bm/v2/bookmarks/${bookmarkId}",FAVORITE_LIST_FOR_MATOME_EDIT:"/api/bookmark/list/odainew/${searchType}/${searchTimestamp}/${searchTerm}/${tagId}/${sinceTimestamp}/${limit}",HAS_FAVORITE:"/api/bookmark/check/${veryFirstDayTimestamp}/${tagId}",SITE_INFO:"/api/document/site?q=${url}",BOOKMARK_TYPES:"/api/bm/v2/bookmarks/types"});
(function($){function apiBookmark(options){_favoriteApi.init(options);
}nj.getPackage("nj.matome.favorite.apiBookmark",apiBookmark);
var _favoriteApi={options:{api:null,data:null,type:"matome",success:function(o,code){},error:function(o,code){}},init:function(options){$.extend(this.options,options);
var that=this,option=this.options,method="POST";
if(option.data.url){option.data.url=decodeURIComponent(option.data.url);
}if(option.api==="add"){_loader.addBookmark({bookmarks:[option.data],from:option.type}).success(this.options.success).error(this.options.error);
}else{_loader.removeBookmark(option.data.url).success(this.options.success).error(this.options.error);
}},check:function(sUrl){return _loader.check(sUrl);
}};
apiBookmark.check=_favoriteApi.check;
var _loader=$.extend(new nj.matome.common.RequestClient(),{addBookmark:function(data){return this.request({requester:"rest",url:nj.common.getAPI("BOOKMARK_ADD"),method:"POST",data:data});
},removeBookmark:function(url){return this.request({requester:"rest",url:nj.common.getAPI("FAVORITE_REMOVE"),method:"POST",data:{matomeUrls:[url]}});
},check:function(sUrl){return this.request({requester:"rest",method:"post",url:nj.common.getAPI("BOOKMARK_CHECK"),data:{url:decodeURIComponent(sUrl)}});
}});
})(jQuery);
(function($){var TEMPLATE={ADD:'<div class="MdTooltip02" data-favorite=""><span class="mdTooltip02Body"><span class="mdTooltip02FVAdd">追加しました</span></span></div>',REMOVE:'<div class="MdTooltip02" data-favorite=""><span class="mdTooltip02Body"><span class="mdTooltip02FVRemove">解除しました</span></span></div>'};
$.widget("matome.favoriteButton",{options:{selected:"ExSelected",tooltip:false,top:-28,left:-2,disable:false,appendTarget:document.body,positionLabel:"bottom-left",marginPosition:{},type:"matome",onAdd:$.noop,onRemove:$.noop,onShowTagSetting:$.noop,onHideTagSetting:$.noop},_init:function(){var that=this;
if(this.element.is("a")){this.element.click(function(){var $el=$(this);
that._click($el,$el);
$el.blur();
return false;
});
}else{this.element.delegate("a","click",function(){var $el=$(this);
that._click($el);
$el.blur();
return false;
});
}this.element.bind("mouseenter",function(){if(that.isEnable()){that.tagSetting(true);
}}).bind("mouseleave",function(){that.tagSetting(false);
});
},_click:function($elm,$parent,bLogin){var that=this,option=this.options,p=$elm.offset(),data=this.getFavoriteData(),apiType,template;
if(option.disable){return false;
}if(this._isConnect){return false;
}this.tagSetting(false);
$parent=$parent||$elm.parent();
if(data===undefined){return false;
}if(!$parent.hasClass(option.selected)){apiType="add";
template=TEMPLATE.ADD;
}else{apiType="remove";
template=TEMPLATE.REMOVE;
}if(!bLogin){nj.common.account.layerLogin(function(){that._click($elm,$parent,true);
});
return false;
}this._isConnect=true;
nj.matome.favorite.apiBookmark({api:apiType,type:option.type,data:data,success:function(o,sResultCode){if(o){if(o.hasErrors){switch(o.results[0].resultCode){case 2200:that.enable();
that.tagSetting(true);
break;
case 2110:location.href="/works";
break;
default:nj.common.message.alert("COMMON.SERVER_ERROR");
break;
}}else{if(apiType==="remove"){that.disable();
option.onRemove.apply(that);
that.tagSetting(false,0);
that.clearFavoriteData();
}else{that.setFavoriteData(o.results[0].bookmark);
that.enable();
that.tagSetting(true);
option.onAdd.apply(that);
}if(option.tooltip){var $tpl=$(template).css({top:p.top+option.top+"px",left:p.left+option.left+"px"}).appendTo(document.body);
setTimeout(function(){$tpl.fadeOut("fast",function(){$(this).remove();
});
},500);
}}}else{nj.common.message.alert("COMMON.SERVER_ERROR");
}that._isConnect=false;
},error:function(){nj.common.message.alert("COMMON.SERVER_ERROR");
that._isConnect=false;
return false;
}});
return false;
},enable:function(){this.element.addClass(this.option("selected"));
},disable:function(){this.element.removeClass(this.option("selected"));
},isEnable:function(){return this.element.hasClass(this.option("selected"));
},tagSetting:function(isShow,delay){var $tagSettingBtn,that=this;
if(isShow){if(!this._$tagSettingBtn){var data=that.getFavoriteData();
$tagSettingBtn=$.matome.tagSettingButton.create({appendTarget:that.option("appendTarget"),offsetTarget:that.element,favoriteData:data,positionLabel:that.option("positionLabel"),marginPosition:that.option("marginPosition"),balloonPosition:"absolute",onShow:that.option("onShowTagSetting"),onHide:that.option("onHideTagSetting")});
that._$tagSettingBtn=$tagSettingBtn;
if(that.element.is(":visible")){that._$tagSettingBtn.tagSettingButton("show");
}}else{if(this.element.is(":visible")){this._$tagSettingBtn.tagSettingButton("show");
}}}else{if(this._$tagSettingBtn){this._$tagSettingBtn.tagSettingButton("hide",delay);
}}},clearFavoriteData:function(){var data=this.element.data("favorite")||{};
delete data.bookmarkId;
delete data.bookmarkTags;
this.element.data("favorite",data);
this._$tagSettingBtn.tagSettingButton("destroy");
this._$tagSettingBtn.remove();
this._$tagSettingBtn=null;
},setFavoriteData:function(favData){var data=this.element.data("favorite")||{};
$.extend(data,favData);
this.element.data("favorite",data);
},getFavoriteData:function(){var data=this.element.data("favorite");
if(!data){data=this.element.find("[data-favorite]").data("favorite");
}return data;
}});
})(jQuery);
(function(){var _options={counter:"",check:false,disable:false,positionLabel:"bottom-left"},_$counter=null,_nCount=0;
$.fn.favoriteUpdater=function(options){var that=this,elCounter,$button,oData;
$.extend(_options,options);
_$counter=$(_options.counter);
if(_$counter.length!==0){elCounter=_$counter.get(0);
if(elCounter.nodeType===3){_nCount=elCounter.textContent||elCounter.data||elCounter.innerText;
}else{_nCount=_$counter.eq(0).text();
}}_nCount=parseInt(_nCount)||0;
this.favoriteButton({disable:_options.disable,appendTarget:document.body,positionLabel:_options.positionLabel,marginPosition:_options.marginPosition,onAdd:function(){update(true);
that.favoriteButton("enable");
},onRemove:function(){update(false);
that.favoriteButton("disable");
}}).find("a").data("favorite",{url:location.protocol+"//"+location.hostname+location.pathname});
if(this[0].tagName==="A"){$button=this;
}else{$button=this.find("a");
}oData=$button.data("favorite");
if(!oData.url){return this;
}if(_options.check){nj.matome.favorite.apiBookmark.check(oData.url).success(function(o){if(o&&o.favorite){that.favoriteButton("enable");
}else{that.favoriteButton("disable");
}}).error(function(){that.favoriteButton("disable");
});
}return this;
};
function update(b){var $t;
b?_nCount++:_nCount--;
if(_nCount<0){_nCount=0;
}if(!_$counter.length){return;
}_$counter.each(function(i){if(this.nodeType===3){$t=$(document.createTextNode(_nCount));
$(this).replaceWith($t);
_$counter[i]=$t[0];
}else{$(this).text(_nCount);
}});
}})();
(function(){var URL={hatebu:"http://b.hatena.ne.jp/add",twitter:"https://twitter.com/intent/tweet",facebookLike:"http://www.facebook.com/plugins/like.php",facebookShare:"http://www.facebook.com/share.php"},PARAMS={hatebu:{url:"${url}",title:"${title}",mode:"confirm",is_bm:"1"},twitter:{original_referer:"${referer}",text:"${text}",url:"${url}"},facebookLike:{href:"${url}",send:"true",layout:"standard",width:"450",show_faces:"false",action:"like",colorscheme:"light",font:"",height:"24"},facebookShare:{u:"${url}"}};
if($.browser.msie&&!document.querySelector){URL.facebookLike="http://www.facebook.com/plugins/like.php?href=${url}&send=false&layout=button_count&width=450&show_faces=false&action=like&colorscheme=light&font&height=21";
}$.widget("matome.shareButtons",{options:{template:{frame:'<div class="MdShareBtn${type}List${type}"><ul class="mdShareBtn${type}Ul">\n<li class="mdShareBtn${type}Li"><a class="MdShareBtn${type} FnShareButtonUseURL" href="${hatebu}" title="はてなブックマークで共有する" data-na="NC:hatebu"><span class="mdShareBtn${type}Wrap mdShareBtn${type}Hatena"><span class="mdShareBtn${type}Ico">Hatena Bookmark</span></span></a></li>\n<li class="mdShareBtn${type}Li"><a class="MdShareBtn${type}" href="${twitter}" title="Twitterで共有する" data-na="NC:twitter"><span class="mdShareBtn${type}Wrap mdShareBtn${type}Twitter"><span class="mdShareBtn${type}Ico">Twitter</span></span></a></li>{{if like}}\n<li class="mdShareBtn${type}Li FnShareButtons"></li>{{else}}\n<li class="mdShareBtn${type}Li"><a class="MdShareBtn${type} FnShareButtonUseURL" href="${facebookShare}" title="Facebookで共有する" data-na="NC:facebook"><span class="mdShareBtn${type}Wrap mdShareBtn${type}Facebook"><span class="mdShareBtn${type}Ico">Facebook</span></span></a></li>{{/if}}</ul></div>'},type:"01",sort:["hatebu","twitter","facebook"],likeButtonAttr:{frameborder:0,scrolling:"no",allowtransparency:"true",style:"border:none;overflow:hidden;width:450px;height:35px;"},likeButtonWrapper:{overflow:"hidden",width:"74px",height:"24px"},data:{url:"",referer:location.href,text:""},likeButton:true,windowWidth:550,windowHeight:450,detect:null,onOpen:$.noop,onClose:$.noop},_init:function(){var options=this.option(),oData,$buttons,$fbIframe,$listFb,that=this,bLoaded=false,bIframeHover=false;
options.data.text=nj.unescapeHTML(options.data.text);
oData=this._getEncodeURIs();
if(options.detect){$buttons=this.element;
$buttons.find(options.detect.listClassName||"li").each(function(i){var $anchor=$("a",this);
switch(options.detect.sort[i]){case"twitter":$anchor.attr("href",oData.twitter);
break;
case"facebook":$anchor.attr("href",oData.facebookShare);
$anchor.addClass("FnShareButtonUseURL");
break;
case"hatebu":$anchor.attr("href",oData.hatebu);
$anchor.addClass("FnShareButtonUseURL");
break;
}});
}else{$buttons=this.element.find(".MdShareBtn01List01");
if($buttons.length){$buttons.remove();
$buttons=null;
}oData.like=options.likeButton;
oData.type=options.type;
if(!options.template.buttons||typeof options.template.buttons==="string"){$buttons=$.tmpl(options.template.buttons||options.template.frame,oData);
}else{$buttons=$.tmpl(options.template.frame,oData);
var $buttonsList=$buttons.find("ul");
var $btn;
for(var i=0,n=options.sort.length;
i<n;
i++){$btn=$.tmpl(options.template.buttons[options.sort[i]],oData);
$buttonsList.append($btn);
}}if(options.likeButton){$buttons.css("display","none");
$listFb=$buttons.find(".FnShareButtons");
$listFb.css(options.likeButtonWrapper);
$fbIframe=$("<iframe/>");
$fbIframe.attr(options.likeButtonAttr).attr("src",oData.facebookLike).bind("load",function(){$buttons.css("display","");
bLoaded=true;
}).appendTo($listFb);
}if(!options.data.url){$buttons.find(".FnShareButtonUseURL").addClass("ExDisabled");
}this.element.append($buttons);
if($.browser.msie){$listFb&&this.element.mouseover(function(){$listFb.css(options.likeButtonWrapper);
bLoaded&&$buttons.show();
}).mouseout(function(){if(!bIframeHover){$buttons.hide();
}});
$fbIframe&&$fbIframe.mouseover(function(){bLoaded&&$buttons.show();
bIframeHover=true;
}).mouseout(function(){bIframeHover=false;
});
}}$buttons.delegate("a","click",function(e){var $btn=$(this);
e.preventDefault();
!$btn.hasClass("ExDisabled")&&that._open($btn.attr("href"));
return false;
});
},_getEncodeURIs:function(){var options=this.option(),oData={},s,aQuery;
$.each(this.element.data("content")||options.data,function(sKey,sVal){options.data[sKey]=sVal;
});
$.each(URL,function(sKey,sUrl){aQuery=[];
$.each(PARAMS[sKey],function(sParam,sVal){aQuery.push(sParam+"="+encodeURIComponent(nj.replaceStr(sVal,options.data)));
});
oData[sKey]=sUrl+"?"+aQuery.join("&");
});
return oData;
},_open:function(sUrl){var options=this.option(),that=this;
if(sUrl){this._trigger("onOpen");
if($.windowMonitor){$.windowMonitor({url:sUrl,name:"socialWindow",onClose:function(){that._trigger("onClose");
}},{width:options.windowWidth,height:options.windowHeight});
}else{var w=window.open(sUrl,"socialWindow","width="+options.windowWidth+",height="+options.windowHeight);
w.focus();
}}}});
})();
(function(){var template,_isWinXPIE;
_isWinXPIE=$.browser.msie&&/windows nt 5.1/.test(window.navigator.userAgent.toLowerCase());
$.widget("matome.tagSettingButton",{options:{zIndex:1000,appendTarget:document.body,offsetTarget:document.body,fixedPosition:{},onShow:$.noop,onHide:$.noop,onOpen:$.noop,onClose:$.noop,onUpdateTag:$.noop,favoriteData:{},balloonPosition:"",positionLabel:"",positionType:"",positionClassName:{"top-left":"mdTooltip01UL","bottom-right":"mdTooltip01BR","bottom-left":"mdTooltip01BL","center-right":"mdTooltip01R"},marginPosition:{top:-2},pointerGather:false},_create:function(){var className,options,_this=this;
options=this.option();
this.removeTimer=0;
className=options.positionClassName[options.positionLabel]||"";
this.element.addClass(className).css({zIndex:this.option("zIndex")}).bind("mouseenter",function(){return _this.stopHide();
}).bind("mouseleave",function(){return _this.hide();
}).bootOn("nj.matome.favorite.tag.layer").click(function(){return _this._openTagLayer();
});
},show:function(){var $appendTarget,$offsetTarget,$pointer,baseOffset,beforeOffset,k,offset,pos,position,positionLabel,s,v,_ref;
positionLabel=this.option("positionLabel");
$appendTarget=$(this.option("appendTarget"));
pos=$appendTarget.css("position");
if(pos!=="absolute"&&pos!=="relative"){$appendTarget.css("position","relative");
}$offsetTarget=$(this.option("offsetTarget"));
if(!$offsetTarget.length){return;
}position=this.option("balloonPosition");
if(position){this.element.css("position",position);
}baseOffset=$appendTarget.offset();
offset=$offsetTarget.offset();
$pointer=this.element.find(".FnPointer");
offset.top-=baseOffset.top;
offset.left-=baseOffset.left;
beforeOffset=this.element.offset();
this.element.offset({top:0,left:0});
if(positionLabel!=="center-right"){offset.top-=this.element.height()+$pointer.height();
}this.element.offset(beforeOffset);
_ref=this.options.marginPosition;
for(k in _ref){v=_ref[k];
offset[k]+=v;
}if(this.options.fixedPosition.right!=null){offset.right=this.options.fixedPosition.right;
delete offset.left;
this.element.css("left","");
}else{if(this.options.fixedPosition.left!=null){offset.left=this.options.fixedPosition.left;
delete offset.right;
this.element.css("right","");
}else{if(positionLabel==="top-left"){offset.top+=$offsetTarget.height()+this.element.height()+$pointer.height();
}else{if(positionLabel==="bottom-right"){offset.left-=this.element.width()-parseInt($pointer.css("right"),10)-$pointer.width();
}else{if(positionLabel==="center-right"){offset.top=offset.top+$offsetTarget.height()/2-this.element.height()/2;
offset.left-=this.element.width()+$pointer.width();
}}}if(this.options.pointerGather){offset.left-=parseInt($pointer.css("left"),10)+$pointer.width()/2;
}}}this.stopHide();
this._show(100);
for(s in offset){this.element.css(s,offset[s]);
}},_show:function(speed){var $dfd,_this=this;
$dfd=$.Deferred();
if(_isWinXPIE){this.element.show();
$dfd.resolve();
this._trigger("onShow");
}else{this.element.stop().fadeTo(speed,1,function(){$dfd.resolve();
_this._trigger("onShow");
});
}return $dfd;
},hide:function(timer){var $dfd,_this=this;
if(timer==null){timer=800;
}$dfd=null;
if(!timer){$dfd=this._hide(100);
}else{$dfd=$.Deferred();
this.removeTimer=setTimeout(function(){_this._hide(100).done(function(){return $dfd.resolve();
});
},timer);
}return $dfd;
},_hide:function(speed){var $dfd,_this=this;
$dfd=$.Deferred();
if(_isWinXPIE){this.element.hide();
$dfd.resolve();
this._trigger("onHide");
}else{this.element.fadeTo(speed,0,function(){_this.element.hide();
$dfd.resolve();
_this._trigger("onHide");
});
}return $dfd;
},stopHide:function(){if(this.removeTimer){clearTimeout(this.removeTimer);
}return this;
},_openTagLayer:function(){var data,_this=this;
data=this.option("favoriteData");
this.hide(0);
this._open();
this.$tagLayer=$.matome.tagLayer.create({setData:data,autoBookmarkTagsFetch:true,onClose:function(){return _this._close();
},onSave:function(res){return _this._close(res);
},onUpdateTag:function(res){return _this._trigger("onUpdateTag",{},res);
}});
return this;
},_open:function(){this._trigger("onOpen");
return this;
},_close:function(data){var beforeData;
beforeData=this.option("favoriteData");
if(data){beforeData.bookmarkTags=data[0].bookmarkTags;
this.option("favoriteData",beforeData);
}this._trigger("onClose",{},{data:data});
return this;
}});
template='<div class="MdTooltip01"><a class="mdTooltip01Link">タグ設定</a><span class="mdTooltip01Pointer FnPointer"></span><!--/MdTooltip01--></div>';
$.matome.tagSettingButton.create=function(option){var $btn;
option=$.extend({},$.matome.tagSettingButton.prototype.options,option);
$btn=$(template);
$btn.hide().appendTo(option.appendTarget);
$btn.tagSettingButton(option);
return $btn;
};
})();


/* @release 1382429670 */